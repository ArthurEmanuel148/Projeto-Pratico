<ion-content class="ion-padding responsavel-content">
  <div class="welcome-container">
    <div class="welcome-header">
      <ion-icon name="home-outline" color="primary" class="welcome-icon"></ion-icon>
      <h1>Bem-vindo(a), {{ usuarioLogado?.pessoa?.nmPessoa || usuarioLogado?.nomePessoa || 'Respons√°vel' }}!</h1>
      <p>Esta √© sua √°rea exclusiva para acompanhar a matr√≠cula da sua fam√≠lia.</p>

      <!-- Bot√£o de debug tempor√°rio -->
      <ion-button size="small" fill="clear" color="medium" (click)="debugDados()">
        <ion-icon name="bug-outline" slot="start"></ion-icon>
        Debug
      </ion-button>
    </div>
  </div>

  <!-- Se√ß√£o de Informa√ß√µes da Matr√≠cula -->
  <div class="section-container" *ngIf="familiaDocumentos">
    <ion-card>
      <ion-card-header>
        <ion-card-title color="primary">
          <ion-icon name="school-outline" slot="start"></ion-icon>
          Situa√ß√£o da Matr√≠cula
        </ion-card-title>
      </ion-card-header>
      <ion-card-content>
        <div class="status-info">
          <ion-chip color="success">
            <ion-icon name="checkmark-circle-outline"></ion-icon>
            <ion-label>Matr√≠cula Ativa</ion-label>
          </ion-chip>
          <p>Sua matr√≠cula est√° ativa. Complete o envio dos documentos necess√°rios.</p>

          <!-- Resumo de documentos -->
          <div class="resumo-documentos" *ngIf="familiaDocumentos.resumo">
            <p><strong>Total de documentos:</strong> {{ familiaDocumentos.resumo.totalDocumentos }}</p>
            <p><strong>Pendentes:</strong> {{ familiaDocumentos.resumo.pendentes }}</p>
            <p><strong>Anexados:</strong> {{ familiaDocumentos.resumo.anexados }}</p>
            <p><strong>Aprovados:</strong> {{ familiaDocumentos.resumo.aprovados }}</p>
          </div>
        </div>
      </ion-card-content>
    </ion-card>
  </div>

  <!-- Se√ß√£o de Sele√ß√£o de Pessoa -->
  <div class="section-container" *ngIf="familiaDocumentos && familiaDocumentos.documentosPorPessoa.length > 0">
    <ion-card>
      <ion-card-header>
        <ion-card-title color="primary">
          <ion-icon name="people-outline" slot="start"></ion-icon>
          Selecionar Pessoa
        </ion-card-title>
        <ion-card-subtitle>Escolha o membro da fam√≠lia para gerenciar os documentos</ion-card-subtitle>
      </ion-card-header>
      <ion-card-content>
        <div class="pessoas-grid">
          <ion-card *ngFor="let pessoa of familiaDocumentos.documentosPorPessoa"
            [class.selected]="pessoaSelecionada && pessoaSelecionada.pessoa.id === pessoa.pessoa.id" (click)="selecionarPessoa(pessoa)"
            button>
            <ion-card-content class="pessoa-card">
              <div class="pessoa-header">
                <ion-icon [name]="obterIconeParentesco(pessoa.pessoa.parentesco)"
                  [color]="obterCorParentesco(pessoa.pessoa.parentesco)"></ion-icon>
                <div class="pessoa-info">
                  <h3>{{ pessoa.pessoa.nome }}</h3>
                  <p>{{ obterDescricaoParentesco(pessoa.pessoa.parentesco) }}</p>
                </div>
              </div>
              <div class="pessoa-stats">
                <ion-chip [color]="obterEstatisticasPessoa(pessoa).pendentes > 0 ? 'warning' : 'success'" size="small">
                  {{ obterEstatisticasPessoa(pessoa).pendentes }} pendente(s)
                </ion-chip>
                <ion-chip color="primary" size="small">
                  {{ obterEstatisticasPessoa(pessoa).total }} total
                </ion-chip>
              </div>
            </ion-card-content>
          </ion-card>
        </div>
      </ion-card-content>
    </ion-card>
  </div>

  <!-- Se√ß√£o de Documentos da Pessoa Selecionada -->
  <div class="section-container" *ngIf="pessoaSelecionada">
    <ion-card>
      <ion-card-header>
        <ion-card-title color="primary">
          <ion-icon [name]="obterIconeDocumento('todos')" slot="start"></ion-icon>
          Documentos de {{ pessoaSelecionada.pessoa.nome }}
        </ion-card-title>
        <ion-card-subtitle>{{ obterDescricaoParentesco(pessoaSelecionada.pessoa.parentesco) }}</ion-card-subtitle>
      </ion-card-header>
      <ion-card-content>
        <!-- Loading de documentos -->
        <div *ngIf="documentosCarregando" class="loading-container">
          <ion-spinner name="crescent"></ion-spinner>
          <p>Carregando documentos...</p>
        </div>

        <!-- Lista de documentos da pessoa selecionada -->
        <div *ngIf="!documentosCarregando && pessoaSelecionada.documentos.length > 0">
          <ion-list>
            <ion-item *ngFor="let documento of pessoaSelecionada.documentos">
              <ion-icon [name]="obterIconeDocumento(documento.tipoDocumento.categoria)" slot="start"
                [color]="obterCorStatus(documento.status)"></ion-icon>
              <ion-label>
                <h2>{{ documento.tipoDocumento.nome }}</h2>
                <p>{{ documento.tipoDocumento.descricao }}</p>
                <p *ngIf="documento.nomeArquivo" class="arquivo-anexado">
                  üìé {{ documento.nomeArquivo }}
                </p>
              </ion-label>
              <ion-chip slot="end" [color]="obterCorStatus(documento.status)">
                <ion-icon name="time-outline" *ngIf="documento.status === 'pendente'"></ion-icon>
                <ion-icon name="cloud-upload-outline" *ngIf="documento.status === 'anexado'"></ion-icon>
                <ion-icon name="checkmark-circle-outline" *ngIf="documento.status === 'aprovado'"></ion-icon>
                <ion-icon name="close-circle-outline" *ngIf="documento.status === 'rejeitado'"></ion-icon>
                <ion-label>{{ documento.status | titlecase }}</ion-label>
              </ion-chip>

              <!-- Bot√µes de a√ß√£o -->
              <div slot="end" class="action-buttons">
                <ion-button fill="clear" size="small" (click)="anexarDocumento(documento)"
                  *ngIf="documento.status === 'pendente' || documento.status === 'rejeitado'">
                  <ion-icon name="attach-outline"></ion-icon>
                </ion-button>
                <ion-button fill="clear" size="small" (click)="baixarDocumento(documento)"
                  *ngIf="documento.status !== 'pendente'">
                  <ion-icon name="download-outline"></ion-icon>
                </ion-button>
                <ion-button fill="clear" size="small" color="danger" (click)="removerDocumento(documento)"
                  *ngIf="documento.status === 'anexado' || documento.status === 'rejeitado'">
                  <ion-icon name="trash-outline"></ion-icon>
                </ion-button>
              </div>
            </ion-item>
          </ion-list>
        </div>

        <!-- Mensagem quando n√£o h√° documentos para a pessoa -->
        <div *ngIf="!documentosCarregando && pessoaSelecionada.documentos.length === 0" class="no-documents">
          <ion-icon name="document-text-outline" color="medium" size="large"></ion-icon>
          <h3>Nenhum documento encontrado</h3>
          <p>N√£o h√° documentos configurados para {{ pessoaSelecionada.pessoa.nome }}.</p>
        </div>
      </ion-card-content>
    </ion-card>
  </div>

  <!-- Mensagem quando n√£o h√° documentos carregados -->
  <div *ngIf="!documentosCarregando && !familiaDocumentos" class="no-documents">
    <ion-icon name="document-text-outline" color="medium" size="large"></ion-icon>
    <h3>Nenhum documento encontrado</h3>
    <p>N√£o foram encontrados documentos para sua fam√≠lia. Entre em contato com a secretaria.</p>
  </div>

  <!-- Se√ß√£o de Informa√ß√µes de Contato -->
  <div class="section-container">
    <ion-card>
      <ion-card-header>
        <ion-card-title color="primary">
          <ion-icon name="call-outline" slot="start"></ion-icon>
          Precisa de Ajuda?
        </ion-card-title>
      </ion-card-header>
      <ion-card-content>
        <p>Entre em contato conosco caso tenha d√∫vidas sobre o processo de matr√≠cula:</p>

        <ion-item lines="none">
          <ion-icon name="call" slot="start" color="primary"></ion-icon>
          <ion-label>
            <h3>Telefone</h3>
            <p>(31) 3822-9999</p>
          </ion-label>
        </ion-item>

        <ion-item lines="none">
          <ion-icon name="mail" slot="start" color="primary"></ion-icon>
          <ion-label>
            <h3>E-mail</h3>
            <p>contato&#64;cipalam.org.br</p>
          </ion-label>
        </ion-item>

        <ion-item lines="none">
          <ion-icon name="time" slot="start" color="primary"></ion-icon>
          <ion-label>
            <h3>Hor√°rio de Atendimento</h3>
            <p>Segunda a Sexta: 8h √†s 17h</p>
          </ion-label>
        </ion-item>
      </ion-card-content>
    </ion-card>
  </div>

  <!-- Se√ß√£o de Informa√ß√µes de Contato -->
  <div class="section-container">
    <ion-card>
      <ion-card-header>
        <ion-card-title color="primary">
          <ion-icon name="call-outline" slot="start"></ion-icon>
          Precisa de Ajuda?
        </ion-card-title>
      </ion-card-header>
      <ion-card-content>
        <p>Entre em contato conosco caso tenha d√∫vidas sobre o processo de matr√≠cula:</p>

        <ion-item lines="none">
          <ion-icon name="call" slot="start" color="primary"></ion-icon>
          <ion-label>
            <h3>Telefone</h3>
            <p>(31) 3822-9999</p>
          </ion-label>
        </ion-item>

        <ion-item lines="none">
          <ion-icon name="mail" slot="start" color="primary"></ion-icon>
          <ion-label>
            <h3>E-mail</h3>
            <p>contato&#64;cipalam.org.br</p>
          </ion-label>
        </ion-item>

        <ion-item lines="none">
          <ion-icon name="time" slot="start" color="primary"></ion-icon>
          <ion-label>
            <h3>Hor√°rio de Atendimento</h3>
            <p>Segunda a Sexta: 8h √†s 17h</p>
          </ion-label>
        </ion-item>
      </ion-card-content>
    </ion-card>
  </div>
</ion-content>