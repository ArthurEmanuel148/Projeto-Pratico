<ion-content class="ion-padding responsavel-content">
  <!-- Header de Boas-vindas Melhorado -->
  <div class="welcome-container">
    <div class="welcome-header">
      <ion-icon name="home" class="welcome-icon"></ion-icon>
      <h1>Olá, {{ usuarioLogado?.pessoa?.nmPessoa || usuarioLogado?.nomePessoa || 'Responsável' }}!</h1>
      <p>Gerencie os documentos necessários para a matrícula da sua família</p>
    </div>
  </div>

  <!-- Loading -->
  <div class="section-container" *ngIf="carregando">
    <div class="loading-container">
      <ion-spinner name="dots"></ion-spinner>
      <p>Carregando documentos da família...</p>
    </div>
  </div>

  <!-- Resumo da Situação -->
  <div class="section-container" *ngIf="!carregando && familiaDocumentos">
    <ion-card>
      <ion-card-header>
        <ion-card-title>
          <ion-icon name="analytics-outline"></ion-icon>
          Resumo dos Documentos
        </ion-card-title>
        <ion-card-subtitle>
          Acompanhe o progresso do envio dos documentos de toda a família
        </ion-card-subtitle>
      </ion-card-header>
      <ion-card-content>
        <div class="resumo-documentos" *ngIf="familiaDocumentos.resumo">
          <div class="resumo-item">
            <ion-badge color="medium">{{ familiaDocumentos.resumo.totalDocumentos }}</ion-badge>
            <span>Total</span>
          </div>
          <div class="resumo-item">
            <ion-badge color="warning">{{ familiaDocumentos.resumo.pendentes }}</ion-badge>
            <span>Pendentes</span>
          </div>
          <div class="resumo-item">
            <ion-badge color="primary">{{ familiaDocumentos.resumo.anexados }}</ion-badge>
            <span>Enviados</span>
          </div>
          <div class="resumo-item">
            <ion-badge color="success">{{ familiaDocumentos.resumo.aprovados }}</ion-badge>
            <span>Aprovados</span>
          </div>
          <div class="resumo-item" *ngIf="familiaDocumentos.resumo.rejeitados > 0">
            <ion-badge color="danger">{{ familiaDocumentos.resumo.rejeitados }}</ion-badge>
            <span>Rejeitados</span>
          </div>
        </div>
      </ion-card-content>
    </ion-card>
  </div>

  <!-- Seleção de Membros da Família -->
  <div class="section-container"
    *ngIf="!carregando && familiaDocumentos && familiaDocumentos.documentosPorPessoa.length > 0">
    <ion-card>
      <ion-card-header>
        <ion-card-title>
          <ion-icon name="people"></ion-icon>
          Membros da Família
        </ion-card-title>
        <ion-card-subtitle>
          Selecione um membro para visualizar os documentos necessários
        </ion-card-subtitle>
      </ion-card-header>
      <ion-card-content>
        <div class="pessoas-grid">
          <div *ngFor="let pessoa of familiaDocumentos.documentosPorPessoa" class="pessoa-card"
            [class.selected]="pessoaSelecionada && pessoaSelecionada.pessoa.id === pessoa.pessoa.id"
            (click)="selecionarPessoa(pessoa)">

            <div class="pessoa-header">
              <ion-icon [name]="obterIconeParentesco(pessoa.pessoa.parentesco)"
                [color]="obterCorParentesco(pessoa.pessoa.parentesco)"></ion-icon>
              <div class="pessoa-info">
                <h3>{{ pessoa.pessoa.nome }}</h3>
                <p class="parentesco">{{ obterDescricaoParentesco(pessoa.pessoa.parentesco) }}</p>
                <div class="documentos-status">
                  <span class="pendentes" *ngIf="obterEstatisticasPessoa(pessoa).pendentes > 0">
                    {{ obterEstatisticasPessoa(pessoa).pendentes }} pendente(s)
                  </span>
                  <span class="aprovados" *ngIf="obterEstatisticasPessoa(pessoa).aprovados > 0">
                    {{ obterEstatisticasPessoa(pessoa).aprovados }} aprovado(s)
                  </span>
                </div>
              </div>
            </div>
          </div>
        </div>
      </ion-card-content>
    </ion-card>
  </div>

  <!-- Documentos da Pessoa Selecionada -->
  <div class="section-container documentos-pessoa" *ngIf="!carregando && pessoaSelecionada">
    <ion-card>
      <ion-card-header>
        <ion-card-title>
          <ion-icon [name]="obterIconeParentesco(pessoaSelecionada.pessoa.parentesco)"></ion-icon>
          Documentos de {{ pessoaSelecionada.pessoa.nome }}
        </ion-card-title>
        <ion-card-subtitle>
          {{ obterDescricaoParentesco(pessoaSelecionada.pessoa.parentesco) }} -
          {{ pessoaSelecionada.documentos.length }} documento(s) necessário(s)
        </ion-card-subtitle>
      </ion-card-header>
      <ion-card-content>
        <!-- Lista de documentos aprimorada -->
        <ion-list *ngIf="pessoaSelecionada.documentos.length > 0">
          <ion-item *ngFor="let documento of pessoaSelecionada.documentos">
            <ion-icon slot="start" [name]="obterIconeDocumento(documento.tipoDocumento.categoria)"
              [color]="obterCorStatus(documento.status)"></ion-icon>

            <ion-label>
              <h2>{{ documento.tipoDocumento.nome }}</h2>
              <p>{{ documento.tipoDocumento.descricao }}</p>

              <!-- Arquivo anexado -->
              <p *ngIf="documento.nomeArquivo" class="arquivo-anexado">
                <ion-icon name="document"></ion-icon>
                {{ documento.nomeArquivo }}
              </p>

              <!-- Observações -->
              <p *ngIf="documento.observacoes" class="observacoes">
                <ion-icon name="alert-circle"></ion-icon>
                {{ documento.observacoes }}
              </p>

              <!-- Datas importantes -->
              <div class="documento-datas" *ngIf="documento.dataEnvio || documento.dataAprovacao">
                <small *ngIf="documento.dataEnvio">
                  Enviado: {{ documento.dataEnvio | date:'dd/MM/yyyy' }}
                </small>
                <small *ngIf="documento.dataAprovacao">
                  Aprovado: {{ documento.dataAprovacao | date:'dd/MM/yyyy' }}
                </small>
              </div>
            </ion-label>

            <!-- Status -->
            <ion-chip slot="end" [color]="obterCorStatus(documento.status)">
              {{ documento.statusDescricao }}
            </ion-chip>

            <!-- Ações -->
            <div slot="end" class="document-actions">
              <ion-button fill="clear" size="small" color="primary"
                *ngIf="documento.status === 'pendente' || documento.status === 'rejeitado'"
                (click)="anexarDocumento(documento)">
                <ion-icon name="cloud-upload"></ion-icon>
              </ion-button>

              <ion-button fill="clear" size="small" color="medium" *ngIf="documento.nomeArquivo"
                (click)="baixarDocumento(documento)">
                <ion-icon name="download"></ion-icon>
              </ion-button>
            </div>
          </ion-item>
        </ion-list>

        <!-- Estado vazio - Nenhum documento para a pessoa -->
        <div *ngIf="pessoaSelecionada.documentos.length === 0" class="no-documents-pessoa">
          <ion-icon name="document-text-outline"></ion-icon>
          <h3>Nenhum documento necessário</h3>
          <p>Não há documentos configurados para {{ pessoaSelecionada.pessoa.nome }}.</p>
        </div>
      </ion-card-content>
    </ion-card>
  </div>

  <!-- Estado vazio - Nenhuma família carregada -->
  <div class="section-container" *ngIf="!carregando && !familiaDocumentos">
    <div class="no-documents">
      <ion-icon name="folder-open-outline"></ion-icon>
      <h3>Nenhum documento encontrado</h3>
      <p>Não foram encontrados documentos para sua família. Entre em contato com a secretaria para mais informações.</p>
    </div>
  </div>

  <!-- Informações de Contato -->
  <div class="section-container">
    <ion-card>
      <ion-card-header>
        <ion-card-title>
          <ion-icon name="help-circle"></ion-icon>
          Precisa de Ajuda?
        </ion-card-title>
        <ion-card-subtitle>
          Nossa equipe está disponível para esclarecer suas dúvidas
        </ion-card-subtitle>
      </ion-card-header>
      <ion-card-content>
        <ion-item lines="none">
          <ion-icon name="call" slot="start" color="primary"></ion-icon>
          <ion-label>
            <h3>Telefone</h3>
            <p>(31) 3822-9999</p>
          </ion-label>
        </ion-item>

        <ion-item lines="none">
          <ion-icon name="mail" slot="start" color="primary"></ion-icon>
          <ion-label>
            <h3>E-mail</h3>
            <p>contato&#64;cipalam.org.br</p>
          </ion-label>
        </ion-item>

        <ion-item lines="none">
          <ion-icon name="time" slot="start" color="primary"></ion-icon>
          <ion-label>
            <h3>Horário de Atendimento</h3>
            <p>Segunda a Sexta-feira: 8h às 17h</p>
          </ion-label>
        </ion-item>
      </ion-card-content>
    </ion-card>
  </div>
</ion-content>