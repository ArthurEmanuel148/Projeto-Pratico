<ion-header [translucent]="true">
  <ion-toolbar color="primary">
    <ion-title class="header-title">
      <ion-icon name="folder-open" class="header-icon"></ion-icon>
      Painel do Responsável
    </ion-title>
    <ion-buttons slot="end">
      <ion-button fill="clear" (click)="carregarDocumentosFamilia()">
        <ion-icon name="refresh" [class.spin]="carregando"></ion-icon>
      </ion-button>
    </ion-buttons>
  </ion-toolbar>
</ion-header>

<ion-content [fullscreen]="true" class="modern-content">
  <!-- Hero Section -->
  <div class="hero-section">
    <div class="hero-content">
      <div class="user-avatar">
        <ion-icon name="person-circle"></ion-icon>
      </div>
      <h1>Olá, {{ usuarioLogado?.pessoa?.nmPessoa || usuarioLogado?.nomePessoa || 'Responsável' }}!</h1>
      <p>Gerencie os documentos necessários para a matrícula da sua família</p>
    </div>
    <div class="hero-decoration">
      <div class="decoration-circle circle-1"></div>
      <div class="decoration-circle circle-2"></div>
      <div class="decoration-circle circle-3"></div>
    </div>
  </div>

  <!-- Loading State -->
  <div class="loading-section" *ngIf="carregando">
    <div class="loading-content">
      <ion-spinner name="dots" color="primary"></ion-spinner>
      <h3>Carregando documentos...</h3>
      <p>Aguarde enquanto buscamos os documentos da sua família</p>
    </div>
  </div>

  <!-- Main Content -->
  <div class="main-content" *ngIf="!carregando">

    <!-- Quick Stats Dashboard -->
    <div class="stats-dashboard" *ngIf="familiaDocumentos">
      <h2 class="section-title">
        <ion-icon name="analytics"></ion-icon>
        Resumo dos Documentos
      </h2>

      <div class="stats-grid" *ngIf="familiaDocumentos.resumo">
        <div class="stat-card total">
          <div class="stat-icon">
            <ion-icon name="documents"></ion-icon>
          </div>
          <div class="stat-info">
            <span class="stat-number">{{ familiaDocumentos.resumo.totalDocumentos }}</span>
            <span class="stat-label">Total</span>
          </div>
        </div>

        <div class="stat-card pending">
          <div class="stat-icon">
            <ion-icon name="time"></ion-icon>
          </div>
          <div class="stat-info">
            <span class="stat-number">{{ familiaDocumentos.resumo.pendentes }}</span>
            <span class="stat-label">Pendentes</span>
          </div>
        </div>

        <div class="stat-card sent">
          <div class="stat-icon">
            <ion-icon name="cloud-upload"></ion-icon>
          </div>
          <div class="stat-info">
            <span class="stat-number">{{ familiaDocumentos.resumo.anexados }}</span>
            <span class="stat-label">Enviados</span>
          </div>
        </div>

        <div class="stat-card approved">
          <div class="stat-icon">
            <ion-icon name="checkmark-circle"></ion-icon>
          </div>
          <div class="stat-info">
            <span class="stat-number">{{ familiaDocumentos.resumo.aprovados }}</span>
            <span class="stat-label">Aprovados</span>
          </div>
        </div>
      </div>
    </div>

    <!-- Family Members Section -->
    <div class="family-section" *ngIf="familiaDocumentos && familiaDocumentos.documentosPorPessoa.length > 0">
      <h2 class="section-title">
        <ion-icon name="people"></ion-icon>
        Membros da Família
      </h2>

      <div class="family-grid">
        <div *ngFor="let pessoa of familiaDocumentos.documentosPorPessoa" class="member-card"
          [class.selected]="pessoaSelecionada && pessoaSelecionada.pessoa.id === pessoa.pessoa.id"
          (click)="selecionarPessoa(pessoa)">

          <div class="member-avatar">
            <ion-icon [name]="obterIconeParentesco(pessoa.pessoa.parentesco)"></ion-icon>
          </div>

          <div class="member-info">
            <h3>{{ pessoa.pessoa.nome }}</h3>
            <p class="member-role">{{ obterDescricaoParentesco(pessoa.pessoa.parentesco) }}</p>

            <div class="member-stats">
              <span class="stat pending" *ngIf="obterEstatisticasPessoa(pessoa).pendentes > 0">
                {{ obterEstatisticasPessoa(pessoa).pendentes }} pendente(s)
              </span>
              <span class="stat approved" *ngIf="obterEstatisticasPessoa(pessoa).aprovados > 0">
                {{ obterEstatisticasPessoa(pessoa).aprovados }} aprovado(s)
              </span>
            </div>
          </div>

          <div class="member-indicator">
            <ion-icon name="chevron-forward"></ion-icon>
          </div>
        </div>
      </div>
    </div>

    <!-- Documents Section -->
    <div class="documents-section" *ngIf="pessoaSelecionada">
      <h2 class="section-title">
        <ion-icon [name]="obterIconeParentesco(pessoaSelecionada.pessoa.parentesco)"></ion-icon>
        Documentos de {{ pessoaSelecionada.pessoa.nome }}
      </h2>

      <div class="documents-list" *ngIf="pessoaSelecionada.documentos.length > 0">
        <div *ngFor="let documento of pessoaSelecionada.documentos" class="document-card">

          <div class="document-header">
            <div class="document-icon" [ngClass]="documento.status">
              <ion-icon [name]="obterIconeDocumento(documento.tipoDocumento.categoria)"></ion-icon>
            </div>

            <div class="document-info">
              <h3>{{ documento.tipoDocumento.nome }}</h3>
              <p>{{ documento.tipoDocumento.descricao }}</p>
            </div>

            <div class="document-status">
              <ion-chip [color]="obterCorStatus(documento.status)" class="status-chip">
                {{ documento.statusDescricao }}
              </ion-chip>
            </div>
          </div>

          <!-- Document Details -->
          <div class="document-details" *ngIf="documento.nomeArquivo || documento.observacoes || documento.dataEnvio">

            <div class="detail-item" *ngIf="documento.nomeArquivo">
              <ion-icon name="document-attach"></ion-icon>
              <span>{{ documento.nomeArquivo }}</span>
            </div>

            <div class="detail-item warning" *ngIf="documento.observacoes">
              <ion-icon name="warning"></ion-icon>
              <span>{{ documento.observacoes }}</span>
            </div>

            <div class="detail-item" *ngIf="documento.dataEnvio">
              <ion-icon name="calendar"></ion-icon>
              <span>Enviado em {{ documento.dataEnvio | date:'dd/MM/yyyy HH:mm' }}</span>
            </div>

            <div class="detail-item success" *ngIf="documento.dataAprovacao">
              <ion-icon name="checkmark-circle"></ion-icon>
              <span>Aprovado em {{ documento.dataAprovacao | date:'dd/MM/yyyy HH:mm' }}</span>
            </div>
          </div>

          <!-- Actions -->
          <div class="document-actions">
            <ion-button fill="outline" size="small"
              *ngIf="documento.status === 'pendente' || documento.status === 'rejeitado'"
              (click)="anexarDocumento(documento)">
              <ion-icon name="cloud-upload" slot="start"></ion-icon>
              {{ documento.status === 'rejeitado' ? 'Reenviar' : 'Anexar' }}
            </ion-button>

            <ion-button fill="clear" size="small" color="medium" *ngIf="documento.nomeArquivo"
              (click)="baixarDocumento(documento)">
              <ion-icon name="download" slot="start"></ion-icon>
              Download
            </ion-button>
          </div>
        </div>
      </div>

      <!-- No Documents for Person -->
      <div class="empty-state" *ngIf="pessoaSelecionada.documentos.length === 0">
        <div class="empty-icon">
          <ion-icon name="document-text-outline"></ion-icon>
        </div>
        <h3>Nenhum documento necessário</h3>
        <p>Não há documentos configurados para {{ pessoaSelecionada.pessoa.nome }}.</p>
      </div>
    </div>

    <!-- No Family Data -->
    <div class="empty-state main" *ngIf="!familiaDocumentos && !carregando">
      <div class="empty-icon">
        <ion-icon name="folder-open-outline"></ion-icon>
      </div>
      <h3>Nenhum documento encontrado</h3>
      <p>
        Não foram encontrados documentos configurados para sua família.<br>
        Verifique se você está logado como responsável ou se há documentos configurados para sua matrícula.
      </p>
      <ion-button fill="outline" (click)="carregarDocumentosFamilia()">
        <ion-icon name="refresh" slot="start"></ion-icon>
        Tentar Novamente
      </ion-button>
    </div>

    <!-- Help Section -->
    <div class="help-section">
      <h2 class="section-title">
        <ion-icon name="help-circle"></ion-icon>
        Precisa de Ajuda?
      </h2>

      <div class="contact-grid">
        <div class="contact-item">
          <ion-icon name="call" color="primary"></ion-icon>
          <div>
            <h4>Telefone</h4>
            <p>(31) 3822-9999</p>
          </div>
        </div>

        <div class="contact-item">
          <ion-icon name="mail" color="primary"></ion-icon>
          <div>
            <h4>E-mail</h4>
            <p>contatocipalam.org.br</p>
          </div>
        </div>

        <div class="contact-item">
          <ion-icon name="time" color="primary"></ion-icon>
          <div>
            <h4>Horário</h4>
            <p>Seg. a Sex: 8h às 17h</p>
          </div>
        </div>
      </div>
    </div>
  </div>
</ion-content>