<ion-header [translucent]="true">
    <ion-toolbar>
        <ion-title>Tipos de Documentos</ion-title>
        <ion-buttons slot="end">
            <ion-button (click)="novoTipoDocumento()" fill="clear">
                <ion-icon name="add" slot="icon-only"></ion-icon>
            </ion-button>
        </ion-buttons>
    </ion-toolbar>
</ion-header>

<ion-content [fullscreen]="true" class="lista-content">
    <!-- Header da página -->
    <div class="page-header">
        <div class="header-content">
            <div class="header-info">
                <h1>Gestão de Tipos de Documentos</h1>
                <p>Configure os tipos de documentos necessários para o processo de matrícula</p>
            </div>
            <div class="header-illustration">
                <ion-icon name="document-text-outline"></ion-icon>
            </div>
        </div>
    </div>

    <!-- Seção de filtros -->
    <div class="filter-section">
        <div class="section-header">
            <div class="section-icon">
                <ion-icon name="funnel-outline"></ion-icon>
            </div>
            <div class="section-title">
                <h2>Filtros</h2>
                <p>Refine sua busca pelos tipos de documentos</p>
            </div>
        </div>

        <div class="filter-content">
            <div class="filter-row">
                <ion-item>
                    <ion-label position="stacked">Nome do Documento</ion-label>
                    <ion-input [(ngModel)]="filtros.nome" (ionInput)="aplicarFiltros()"
                        placeholder="Digite o nome do documento">
                    </ion-input>
                </ion-item>
            </div>

            <div class="filter-row">
                <ion-item>
                    <ion-label position="stacked">Modalidade de Entrega</ion-label>
                    <ion-select [(ngModel)]="filtros.modalidadeEntrega" (ionChange)="aplicarFiltros()"
                        placeholder="Selecione a modalidade">
                        <ion-select-option value="">Todas</ion-select-option>
                        <ion-select-option *ngFor="let modalidade of modalidadesEntrega" [value]="modalidade.value">
                            {{ modalidade.label }}
                        </ion-select-option>
                    </ion-select>
                </ion-item>
            </div>

            <div class="filter-row">
                <ion-item>
                    <ion-label position="stacked">Quem Deve Fornecer</ion-label>
                    <ion-select [(ngModel)]="filtros.quemDeveFornencer" (ionChange)="aplicarFiltros()"
                        placeholder="Selecione o fornecedor">
                        <ion-select-option value="">Todos</ion-select-option>
                        <ion-select-option *ngFor="let opcao of quemDeveFornecerOpcoes" [value]="opcao.value">
                            {{ opcao.label }}
                        </ion-select-option>
                    </ion-select>
                </ion-item>
            </div>

            <div class="filter-row">
                <ion-item>
                    <ion-label position="stacked">Status</ion-label>
                    <ion-select [(ngModel)]="filtros.ativo" (ionChange)="aplicarFiltros()"
                        placeholder="Selecione o status">
                        <ion-select-option [value]="null">Todos</ion-select-option>
                        <ion-select-option *ngFor="let status of statusOptions" [value]="status.value">
                            {{ status.label }}
                        </ion-select-option>
                    </ion-select>
                </ion-item>
            </div>

            <div class="filter-actions">
                <ion-button fill="outline" (click)="limparFiltros()">
                    <ion-icon name="refresh-outline" slot="start"></ion-icon>
                    Limpar Filtros
                </ion-button>
            </div>
        </div>
    </div>

    <!-- Lista de tipos de documentos -->
    <div class="list-section">
        <div class="section-header">
            <div class="section-icon">
                <ion-icon name="list-outline"></ion-icon>
            </div>
            <div class="section-title">
                <h2>Tipos de Documentos Cadastrados</h2>
                <p>{{ tiposDocumentosFiltrados.length }} tipo(s) encontrado(s)</p>
            </div>
            <div class="section-actions">
                <ion-button fill="clear" (click)="novoTipoDocumento()">
                    <ion-icon name="add-circle-outline" slot="start"></ion-icon>
                    Novo Tipo
                </ion-button>
            </div>
        </div>

        <!-- Loading state -->
        <div *ngIf="loading" class="loading-container">
            <ion-spinner name="crescent"></ion-spinner>
            <p>Carregando tipos de documentos...</p>
        </div>

        <!-- Lista vazia -->
        <div *ngIf="!loading && tiposDocumentosFiltrados.length === 0" class="empty-state">
            <div class="empty-illustration">
                <ion-icon name="document-outline"></ion-icon>
            </div>
            <h3>Nenhum tipo de documento encontrado</h3>
            <p *ngIf="tiposDocumentos.length === 0">
                Ainda não há tipos de documentos cadastrados.
                <br>
                Clique no botão "Novo Tipo" para criar o primeiro.
            </p>
            <p *ngIf="tiposDocumentos.length > 0">
                Nenhum tipo de documento corresponde aos filtros aplicados.
                <br>
                Tente ajustar os filtros ou limpar a pesquisa.
            </p>
            <ion-button fill="outline" (click)="novoTipoDocumento()" *ngIf="tiposDocumentos.length === 0">
                <ion-icon name="add-outline" slot="start"></ion-icon>
                Criar Primeiro Tipo de Documento
            </ion-button>
        </div>

        <!-- Cards dos tipos de documentos -->
        <div class="tipos-grid" *ngIf="!loading && tiposDocumentosFiltrados.length > 0">
            <div class="tipo-card" *ngFor="let tipo of tiposDocumentosFiltrados">
                <div class="card-header">
                    <div class="card-title">
                        <h3>{{ tipo.nome }}</h3>
                        <div class="status-badge" [class.ativo]="tipo.ativo" [class.inativo]="!tipo.ativo">
                            {{ tipo.ativo ? 'Ativo' : 'Inativo' }}
                        </div>
                    </div>
                </div>

                <div class="card-content">
                    <div class="card-info">
                        <div class="info-item">
                            <ion-icon name="document-outline"></ion-icon>
                            <span class="label">Modalidade:</span>
                            <span class="value">{{ getModalidadeLabel(tipo.modalidadeEntrega) }}</span>
                        </div>

                        <div class="info-item">
                            <ion-icon name="people-outline"></ion-icon>
                            <span class="label">Fornecedor:</span>
                            <span class="value">{{ getQuemDeveFornecerLabel(tipo.quemDeveFornencer) }}</span>
                        </div>

                        <div class="info-item" *ngIf="tipo.descricao">
                            <ion-icon name="information-circle-outline"></ion-icon>
                            <span class="label">Descrição:</span>
                            <span class="value description">{{ tipo.descricao }}</span>
                        </div>
                    </div>
                </div>

                <div class="card-actions">
                    <ion-button fill="clear" size="small" (click)="editarTipoDocumento(tipo.idTipoDocumento!)">
                        <ion-icon name="create-outline" slot="start"></ion-icon>
                        Editar
                    </ion-button>

                    <ion-button fill="clear" size="small" [color]="tipo.ativo ? 'medium' : 'success'"
                        (click)="alternarStatus(tipo)">
                        <ion-icon [name]="tipo.ativo ? 'pause-outline' : 'play-outline'" slot="start"></ion-icon>
                        {{ tipo.ativo ? 'Desativar' : 'Ativar' }}
                    </ion-button>
                </div>
            </div>
        </div>
    </div>
</ion-content>