<ion-header>
    <ion-toolbar>
        <ion-buttons slot="start">
            <ion-back-button defaultHref="/sistema/dashboard"></ion-back-button>
        </ion-buttons>
        <ion-buttons slot="end">
            <ion-button fill="clear" (click)="novoTipoDocumento()">
                <ion-icon name="add" slot="start"></ion-icon>
                Novo
            </ion-button>
        </ion-buttons>
    </ion-toolbar>
</ion-header>

<ion-content class="ion-padding-horizontal">
    <!-- Header com título e descrição -->
    <div class="page-header">
        <div class="header-content">
            <div class="header-info">
                <h1>Gerenciamento de Tipos de Documentos</h1>
                <p>Gerencie todos os tipos de documentos do sistema. Você pode criar, editar e visualizar informações dos documentos.</p>
            </div>
            <div class="header-illustration">
                <ion-icon name="document-text-outline"></ion-icon>
            </div>
        </div>
    </div>

    <!-- Filtros -->
    <ion-card class="filtros-card">
        <ion-card-header>
            <ion-card-title>
                <ion-icon name="funnel-outline"></ion-icon>
                Filtros
            </ion-card-title>
        </ion-card-header>
        <ion-card-content>
            <ion-row>
                <ion-col size="12" size-md="6" size-lg="4">
                    <ion-searchbar [(ngModel)]="filtros.nome" (ionInput)="aplicarFiltros()"
                        placeholder="Buscar por nome do documento..." debounce="300">
                    </ion-searchbar>
                </ion-col>

                <ion-col size="6" size-md="3" size-lg="2">
                    <ion-item>
                        <ion-label>Modalidade</ion-label>
                        <ion-select [(ngModel)]="filtros.modalidadeEntrega" (ionChange)="aplicarFiltros()" placeholder="Todas">
                            <ion-select-option value="">Todas</ion-select-option>
                            <ion-select-option value="ASSINADO">Assinado</ion-select-option>
                            <ion-select-option value="ANEXADO">Anexado</ion-select-option>
                        </ion-select>
                    </ion-item>
                </ion-col>

                <ion-col size="6" size-md="3" size-lg="2">
                    <ion-item>
                        <ion-label>Status</ion-label>
                        <ion-select [(ngModel)]="filtros.ativo" (ionChange)="aplicarFiltros()" placeholder="Todos">
                            <ion-select-option [value]="null">Todos</ion-select-option>
                            <ion-select-option [value]="true">Ativos</ion-select-option>
                            <ion-select-option [value]="false">Inativos</ion-select-option>
                        </ion-select>
                    </ion-item>
                </ion-col>
            </ion-row>

            <ion-row>
                <ion-col size="12">
                    <ion-button fill="clear" size="small" (click)="limparFiltros()">
                        <ion-icon name="refresh" slot="start"></ion-icon>
                        Limpar Filtros
                    </ion-button>
                </ion-col>
            </ion-row>
        </ion-card-content>
    </ion-card>

    <!-- Lista de Tipos de Documentos -->
    <div class="turmas-lista">
        <div class="lista-header">
            <h2>
                Tipos de Documentos Cadastrados
                <ion-badge color="primary">{{ tiposDocumentosFiltrados.length }}</ion-badge>
            </h2>

            <ion-button (click)="novoTipoDocumento()" color="primary">
                <ion-icon name="add" slot="start"></ion-icon>
                Novo Tipo de Documento
            </ion-button>
        </div>

        <!-- Loading -->
        <div *ngIf="loading" class="loading-container">
            <ion-spinner name="crescent"></ion-spinner>
            <p>Carregando tipos de documentos...</p>
        </div>

        <!-- Lista vazia -->
        <div *ngIf="!loading && tiposDocumentosFiltrados.length === 0" class="lista-vazia">
            <ion-icon name="document-text-outline" color="medium"></ion-icon>
            <h3>Nenhum tipo de documento encontrado</h3>
            <p>
                <span *ngIf="temFiltrosAtivos()">
                    Tente ajustar os filtros ou
                </span>
                <ion-button fill="clear" (click)="novoTipoDocumento()">
                    criar um novo tipo de documento
                </ion-button>
            </p>
        </div>

        <!-- Cards dos tipos de documentos -->
        <ion-card *ngFor="let tipo of tiposDocumentosFiltrados" class="turma-card">
            <ion-card-header>
                <ion-card-subtitle>
                    <ion-chip [color]="getCorModalidade(tipo.modalidadeEntrega)" outline>
                        <ion-icon name="send-outline"></ion-icon>
                        <ion-label>{{ getModalidadeLabel(tipo.modalidadeEntrega) }}</ion-label>
                    </ion-chip>

                    <ion-chip [color]="getCorFornecedor(tipo.quemDeveFornencer)" outline>
                        <ion-icon name="person-outline"></ion-icon>
                        <ion-label>{{ getQuemDeveFornecerLabel(tipo.quemDeveFornencer) }}</ion-label>
                    </ion-chip>

                    <ion-chip [color]="tipo.ativo ? 'success' : 'danger'" outline>
                        <ion-icon [name]="tipo.ativo ? 'checkmark-circle' : 'close-circle'"></ion-icon>
                        <ion-label>{{ tipo.ativo ? 'Ativo' : 'Inativo' }}</ion-label>
                    </ion-chip>
                </ion-card-subtitle>

                <ion-card-title>{{ tipo.nome }}</ion-card-title>
            </ion-card-header>

            <ion-card-content>
                <div class="turma-info">
                    <div class="info-row">
                        <span class="label">Status:</span>
                        <span class="value" [class.text-success]="tipo.ativo"
                            [class.text-danger]="!tipo.ativo">
                            {{ tipo.ativo ? 'Ativo' : 'Inativo' }}
                        </span>
                    </div>

                    <div class="info-row">
                        <span class="label">Modalidade de Entrega:</span>
                        <span class="value">{{ getModalidadeLabel(tipo.modalidadeEntrega) }}</span>
                    </div>

                    <div class="info-row">
                        <span class="label">Quem Deve Fornecer:</span>
                        <span class="value">{{ getQuemDeveFornecerLabel(tipo.quemDeveFornencer) }}</span>
                    </div>

                    <div *ngIf="tipo.descricao" class="observacoes">
                        <span class="label">Descrição:</span>
                        <p>{{ tipo.descricao }}</p>
                    </div>
                </div>

                <!-- Ações -->
                <div class="acoes-turma">
                    <ion-button fill="outline" size="small" (click)="editarTipoDocumento(tipo.idTipoDocumento!, $event)">
                        <ion-icon name="create" slot="start"></ion-icon>
                        Editar
                    </ion-button>

                    <ion-button fill="outline" size="small" 
                        [color]="tipo.ativo ? 'medium' : 'success'" 
                        (click)="alternarStatus(tipo, $event)">
                        <ion-icon [name]="tipo.ativo ? 'pause' : 'play'" slot="start"></ion-icon>
                        {{ tipo.ativo ? 'Desativar' : 'Ativar' }}
                    </ion-button>

                    <ion-button fill="outline" size="small" color="danger" 
                        (click)="excluirTipoDocumento(tipo, $event)">
                        <ion-icon name="trash" slot="start"></ion-icon>
                        Excluir
                    </ion-button>
                </div>
            </ion-card-content>
        </ion-card>
    </div>
</ion-content>
