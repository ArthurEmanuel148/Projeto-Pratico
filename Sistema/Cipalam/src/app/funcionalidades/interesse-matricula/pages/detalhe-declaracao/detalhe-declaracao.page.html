<ion-header>
  <ion-toolbar color="primary">
    <ion-buttons slot="start">
      <ion-back-button defaultHref="/sistema/matriculas/declaracoes"></ion-back-button>
    </ion-buttons>
  </ion-toolbar>
</ion-header>

<!-- T√≠tulo da p√°gina logo abaixo do menu superior -->
<div class="ion-padding">
  <h2 class="ion-text-center">Detalhe da Declara√ß√£o de Interesse</h2>
</div>

<!-- Adicione logo abaixo do t√≠tulo da p√°gina -->
<div class="ion-padding ion-text-start">
  <ion-button fill="clear" color="primary" routerLink="/sistema/matriculas/declaracoes">
    <ion-icon name="arrow-back-outline" slot="start"></ion-icon>
    Voltar para a listagem
  </ion-button>
</div>

<ion-content *ngIf="!carregando && declaracao; else carregandoTpl" class="ion-padding">
  <ion-card *ngIf="declaracao">
    <ion-card-header>
      <ion-card-title>Dados do Aluno</ion-card-title>
    </ion-card-header>
    <ion-card-content>
      <p><strong>Nome:</strong> {{ declaracao.nomeCompleto || (declaracao.dadosAluno && declaracao.dadosAluno.nomeAluno)
        }}</p>
      <p><strong>Data de Nascimento:</strong> {{ declaracao.dadosAluno && declaracao.dadosAluno.dataNascimentoAluno |
        date:'dd/MM/yyyy' }}</p>
      <p><strong>CPF:</strong> {{ declaracao.cpf || (declaracao.dadosAluno && declaracao.dadosAluno.cpfAluno) || 'N√£o
        informado' }}</p>
      <p><strong>Protocolo:</strong> {{ declaracao.protocolo }}</p>
      <p><strong>Status:</strong>
        <ion-badge color="primary">{{ declaracao.status || 'interesse_declarado' }}</ion-badge>
      </p>
    </ion-card-content>
  </ion-card>

  <ion-card *ngIf="declaracao && declaracao.dadosResponsavel">
    <ion-card-header>
      <ion-card-title>Dados do Respons√°vel</ion-card-title>
    </ion-card-header>
    <ion-card-content>
      <p><strong>Nome:</strong> {{ declaracao.dadosResponsavel.nomeResponsavel || 'N√£o informado' }}</p>
      <p><strong>CPF:</strong> {{ declaracao.dadosResponsavel.cpfResponsavel || 'N√£o informado' }}</p>
      <p><strong>Email:</strong> {{ declaracao.email || declaracao.dadosResponsavel.emailResponsavel }}</p>
      <p><strong>Telefone:</strong> {{ declaracao.telefone || declaracao.dadosResponsavel.telefoneResponsavel }}</p>
    </ion-card-content>
  </ion-card>

  <ion-card *ngIf="declaracao">
    <ion-card-header>
      <ion-card-title>Vaga de Interesse</ion-card-title>
    </ion-card-header>
    <ion-card-content>
      <p><strong>Tipo de Cota:</strong> {{ declaracao.tipoCota || (declaracao.tipoVaga && declaracao.tipoVaga.tipoCota)
        }}</p>
      <p><strong>S√©rie Desejada:</strong> {{ declaracao.serieDesejada || 'N√£o informado' }}</p>
      <p><strong>Ano Letivo:</strong> {{ declaracao.anoLetivo || 'N√£o informado' }}</p>
      <p><strong>Tipo de Escola Anterior:</strong> {{ declaracao.tipoEscola || 'N√£o informado' }}</p>
    </ion-card-content>
  </ion-card>

  <ion-card *ngIf="declaracao">
    <ion-card-header>
      <ion-card-title>Dados da Escola</ion-card-title>
    </ion-card-header>
    <ion-card-content>
      <p><strong>Escola do Aluno:</strong> {{ declaracao.tipoEscola || 'N√£o informado' }}</p>
    </ion-card-content>
  </ion-card>

  <!-- Se√ß√£o de Datas Importantes -->
  <ion-card *ngIf="declaracao">
    <ion-card-header>
      <ion-card-title>Datas Importantes</ion-card-title>
    </ion-card-header>
    <ion-card-content>
      <p><strong>Data de Envio da Declara√ß√£o:</strong> {{ (declaracao.dataEnvio | date:'dd/MM/yyyy HH:mm') || 'N√£o
        informado' }}</p>
      <p *ngIf="declaracao.dataInicioMatricula"><strong>Data de In√≠cio da Matr√≠cula:</strong> {{
        declaracao.dataInicioMatricula | date:'dd/MM/yyyy HH:mm' }}</p>
    </ion-card-content>
  </ion-card>

  <ion-card *ngIf="declaracao">
    <ion-card-header>
      <ion-card-title>Endere√ßo da Fam√≠lia</ion-card-title>
    </ion-card-header>
    <ion-card-content>
      <p><strong>Endere√ßo Completo:</strong> {{ declaracao.infoRenda?.enderecoCompleto || 'N√£o informado' }}</p>
    </ion-card-content>
  </ion-card>

  <ion-card *ngIf="declaracao && declaracao.tipoCota === 'economica'">
    <ion-card-header>
      <ion-card-title>üí∞ Informa√ß√µes de Renda</ion-card-title>
    </ion-card-header>
    <ion-card-content>
      <div class="info-row">
        <strong>N√∫mero de Integrantes da Fam√≠lia:</strong>
        <span>{{ declaracao.infoRenda?.numeroIntegrantes || 'N√£o informado' }}</span>
      </div>

      <div *ngIf="integrantesRenda && integrantesRenda.length > 0" class="renda-section">
        <h4>üë• Composi√ß√£o Familiar e Renda:</h4>

        <div class="tabela-container">
          <table class="tabela-integrantes">
            <thead>
              <tr>
                <th>Nome</th>
                <th>Parentesco</th>
                <th>Idade</th>
                <th>Renda</th>
                <th>Tipo Renda</th>
                <th>Ocupa√ß√£o/Obs</th>
              </tr>
            </thead>
            <tbody>
              <tr *ngFor="let integrante of integrantesRenda; let i = index">
                <td class="nome-integrante">
                  <strong>{{ integrante.nome || 'Nome n√£o informado' }}</strong>
                  <small *ngIf="integrante.cpf" class="cpf-integrante">CPF: {{ integrante.cpf }}</small>
                </td>
                <td>{{ integrante.parentesco || 'N√£o informado' }}</td>
                <td>{{ integrante.idade || '-' }} anos</td>
                <td class="valor-renda">{{ integrante.renda ? (integrante.renda | currency:'BRL':'symbol':'1.2-2') : 'R$
                  0,00' }}</td>
                <td>{{ integrante.tipoRenda || '-' }}</td>
                <td class="observacoes-col">
                  <span *ngIf="integrante.ocupacao">{{ integrante.ocupacao }}</span>
                  <span *ngIf="integrante.observacoes" class="obs-extra">{{ integrante.observacoes }}</span>
                  <span *ngIf="!integrante.ocupacao && !integrante.observacoes">-</span>
                </td>
              </tr>
            </tbody>
          </table>
        </div>

        <div class="renda-total" *ngIf="rendaFamiliarCalculada > 0">
          <p><strong>Renda Familiar Total:</strong> {{ rendaFamiliarCalculada | currency:'BRL':'symbol':'1.2-2' }}</p>
          <p><strong>Renda Per Capita:</strong> {{ rendaPerCapitaCalculada | currency:'BRL':'symbol':'1.2-2' }}</p>
        </div>
      </div>

      <div *ngIf="!integrantesRenda || integrantesRenda.length === 0">
        <p style="color: #888; font-style: italic;">Dados de renda n√£o informados</p>
      </div>
    </ion-card-content>
  </ion-card>

  <ion-card *ngIf="declaracao && declaracao.horariosVaga?.horariosSelecionados">
    <ion-card-header>
      <ion-card-title>Hor√°rios de Interesse</ion-card-title>
    </ion-card-header>
    <ion-card-content>
      <div *ngIf="horariosSelecionados && horariosSelecionados.length > 0">
        <ion-list>
          <ion-item *ngFor="let horario of horariosSelecionados">
            <ion-label>{{ horario }}</ion-label>
          </ion-item>
        </ion-list>
      </div>
      <p *ngIf="!horariosSelecionados || horariosSelecionados.length === 0">Nenhum hor√°rio espec√≠fico selecionado</p>
    </ion-card-content>
  </ion-card>

  <ion-card *ngIf="declaracao && declaracao.mensagemAdicional">
    <ion-card-header>
      <ion-card-title>Observa√ß√µes do Respons√°vel</ion-card-title>
    </ion-card-header>
    <ion-card-content>
      <p>{{ declaracao.mensagemAdicional }}</p>
    </ion-card-content>
  </ion-card>

  <ion-card *ngIf="declaracao && declaracao.observacoes">
    <ion-card-header>
      <ion-card-title>Observa√ß√µes Internas</ion-card-title>
    </ion-card-header>
    <ion-card-content>
      <p>{{ declaracao.observacoes }}</p>
    </ion-card-content>
  </ion-card>

  <div class="ion-padding">
    <ion-button expand="block" color="success" (click)="iniciarMatricula()" *ngIf="!matriculaIniciada"
      [disabled]="processandoMatricula">
      <ion-icon name="document-attach-outline" slot="start"></ion-icon>
      {{ processandoMatricula ? 'Processando...' : 'Iniciar Matr√≠cula' }}
    </ion-button>
  </div>

  <ion-card *ngIf="matriculaIniciada">
    <ion-card-header>
      <ion-card-title color="success">
        <ion-icon name="checkmark-circle-outline" slot="start"></ion-icon>
        Matr√≠cula Iniciada com Sucesso!
      </ion-card-title>
    </ion-card-header>
    <ion-card-content>
      <div class="credentials-section">
        <h3>Credenciais do Respons√°vel</h3>
        <ion-item lines="none">
          <ion-label>
            <h4><strong>Usu√°rio:</strong></h4>
            <p>{{ loginGerado?.usuario }}</p>
          </ion-label>
        </ion-item>
        <ion-item lines="none">
          <ion-label>
            <h4><strong>Senha:</strong></h4>
            <p>{{ loginGerado?.senha }}</p>
          </ion-label>
        </ion-item>
        <ion-button expand="block" fill="outline" color="primary" (click)="copiarCredenciais()">
          <ion-icon name="copy-outline" slot="start"></ion-icon>
          Copiar Credenciais
        </ion-button>
      </div>

      <div class="documents-section" *ngIf="documentosNecessarios.length > 0">
        <h3>Documentos Necess√°rios</h3>
        <ion-list>
          <ion-item *ngFor="let doc of documentosNecessarios">
            <ion-icon name="document-outline" slot="start"></ion-icon>
            <ion-label>
              <h4>{{ doc.nome }}</h4>
              <p *ngIf="doc.obrigatorio">
                <ion-badge color="danger">Obrigat√≥rio</ion-badge>
              </p>
            </ion-label>
          </ion-item>
        </ion-list>
      </div>

      <ion-note color="primary" class="ion-margin-top">
        <ion-icon name="information-circle-outline" slot="start"></ion-icon>
        Oriente o respons√°vel a acessar o sistema com essas credenciais para anexar ou assinar os documentos pendentes.
      </ion-note>

      <div class="ion-margin-top">
        <ion-button expand="block" color="primary" (click)="voltarLista()">
          <ion-icon name="arrow-back-outline" slot="start"></ion-icon>
          Voltar para a Lista de Declara√ß√µes
        </ion-button>
      </div>
    </ion-card-content>
  </ion-card>
</ion-content>

<ng-template #carregandoTpl>
  <ion-spinner class="ion-margin"></ion-spinner>
</ng-template>