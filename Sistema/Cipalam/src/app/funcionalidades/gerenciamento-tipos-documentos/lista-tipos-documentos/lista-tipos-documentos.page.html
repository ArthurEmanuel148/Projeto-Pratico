<ion-header>
    <ion-toolbar>
        <ion-buttons slot="start">
            <ion-back-button defaultHref="/sistema/dashboard"></ion-back-button>
        </ion-buttons>
    </ion-toolbar>
</ion-header>

<ion-content class="ion-padding-horizontal">
    <div class="content-container">
        <!-- Header com título e descrição -->
        <div class="page-header">
            <div class="header-content">
                <div class="header-info">
                    <h1>Gerenciamento de Tipos de Documentos</h1>
                    <p>Gerencie todos os tipos de documentos do sistema. Você pode criar, editar e visualizar informações dos documentos.</p>
                </div>
                <div class="header-illustration">
                    <ion-icon name="document-text-outline"></ion-icon>
                </div>
            </div>
        </div>

        <!-- Pesquisa Estilo Gmail -->
        <div class="pesquisa-gmail">
            <div class="search-container">
                <ion-searchbar 
                    [(ngModel)]="filtros.nome" 
                    (ionInput)="aplicarFiltros()"
                    placeholder="Pesquisar tipos de documentos" 
                    debounce="300"
                    show-clear-button="focus"
                    class="gmail-search">
                </ion-searchbar>
                
                <ion-button 
                    fill="clear" 
                    size="small" 
                    class="filtros-toggle"
                    (click)="toggleFiltrosAvancados()"
                    [class.ativo]="mostrarFiltrosAvancados">
                    <ion-icon name="options-outline"></ion-icon>
                </ion-button>
            </div>
            
            <!-- Filtros integrados -->
            <div class="filtros-inline" *ngIf="mostrarFiltrosAvancados">
                <div class="filtro-chips">
                    <ion-chip 
                        [color]="filtros.ativo === true ? 'success' : 'medium'"
                        (click)="toggleFiltroStatus(true)"
                        [outline]="filtros.ativo !== true">
                        <ion-label>Ativos</ion-label>
                    </ion-chip>
                    
                    <ion-chip 
                        [color]="filtros.ativo === false ? 'danger' : 'medium'"
                        (click)="toggleFiltroStatus(false)"
                        [outline]="filtros.ativo !== false">
                        <ion-label>Inativos</ion-label>
                    </ion-chip>
                    
                    <ion-button 
                        fill="clear" 
                        size="small" 
                        (click)="limparFiltros()"
                        *ngIf="temFiltrosAtivos()">
                        <ion-icon name="close" slot="start"></ion-icon>
                        Limpar
                    </ion-button>
                </div>
            </div>
        </div>

        <!-- Lista de Tipos de Documentos em Tabela -->
        <div class="documentos-lista">
            <div class="lista-header">
                <h2>
                    Tipos de Documentos Cadastrados
                    <ion-badge color="primary">{{ tiposDocumentosFiltrados.length }}</ion-badge>
                </h2>

                <ion-button (click)="novoTipoDocumento()" color="primary">
                    <ion-icon name="add" slot="start"></ion-icon>
                    Novo Tipo de Documento
                </ion-button>
            </div>

            <!-- Loading -->
            <div *ngIf="loading" class="loading-container">
                <ion-spinner name="crescent"></ion-spinner>
                <p>Carregando tipos de documentos...</p>
            </div>

            <!-- Lista vazia -->
            <div *ngIf="!loading && tiposDocumentosFiltrados.length === 0" class="lista-vazia">
                <ion-icon name="document-text-outline" color="medium"></ion-icon>
                <h3>Nenhum tipo de documento encontrado</h3>
                <p>
                    <span *ngIf="temFiltrosAtivos()">
                        Tente ajustar os filtros ou
                    </span>
                    <ion-button fill="clear" (click)="novoTipoDocumento()">
                        criar um novo tipo de documento
                    </ion-button>
                </p>
            </div>

            <!-- Tabela de Tipos de Documentos -->
            <div *ngIf="!loading && tiposDocumentosFiltrados.length > 0" class="tabela-container">
                <table class="documentos-table">
                    <thead>
                        <tr>
                            <th>Tipo Documento</th>
                            <th>Quem Fornece</th>
                            <th>Status</th>
                            <th>Ações</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr *ngFor="let tipo of tiposDocumentosFiltrados" class="documento-row">
                            <td class="nome-documento">
                                <div class="documento-info">
                                    <h3>{{ tipo.nome }}</h3>
                                </div>
                            </td>
                            
                            <td class="fornecedor">
                                <span class="fornecedor-texto">{{ tipo.escopo }}</span>
                            </td>
                            
                            <td class="status">
                                <ion-chip [color]="tipo.ativo ? 'success' : 'danger'" outline>
                                    <ion-icon [name]="tipo.ativo ? 'checkmark-circle' : 'close-circle'"></ion-icon>
                                    <ion-label>{{ tipo.ativo ? 'Ativo' : 'Inativo' }}</ion-label>
                                </ion-chip>
                            </td>
                            
                            <td class="acoes">
                                <div class="acoes-container">
                                    <ion-button fill="clear" size="small" color="primary" (click)="editarTipoDocumento(tipo.idTipoDocumento!, $event)">
                                        <ion-icon name="create" slot="icon-only"></ion-icon>
                                    </ion-button>

                                    <ion-button fill="clear" size="small" 
                                        [color]="tipo.ativo ? 'medium' : 'success'" 
                                        (click)="alternarStatus(tipo, $event)">
                                        <ion-icon [name]="tipo.ativo ? 'pause' : 'play'" slot="icon-only"></ion-icon>
                                    </ion-button>

                                    <ion-button fill="clear" size="small" color="danger" 
                                        (click)="excluirTipoDocumento(tipo, $event)">
                                        <ion-icon name="trash" slot="icon-only"></ion-icon>
                                    </ion-button>
                                </div>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
    </div>
</ion-content>
