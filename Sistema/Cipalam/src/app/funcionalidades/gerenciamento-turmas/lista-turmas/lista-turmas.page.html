<ion-header>
    <ion-toolbar>
        <ion-buttons slot="start">
            <ion-back-button defaultHref="/sistema/dashboard"></ion-back-button>
        </ion-buttons>
        <ion-buttons slot="end">
            <ion-button fill="clear" (click)="navegarParaCadastro()" *ngIf="podeGerenciarTurmas">
                <ion-icon name="add" slot="start"></ion-icon>
                Nova
            </ion-button>
        </ion-buttons>
    </ion-toolbar>
</ion-header>

<ion-content class="ion-padding-horizontal">
    <div class="content-container">
        <!-- Header com título e descrição -->
        <div class="page-header">
            <div class="header-content">
                <div class="header-info">
                    <h1>Gerenciamento de Turmas</h1>
                    <p>Gerencie todas as turmas do sistema. Você pode criar, editar e visualizar informações das turmas.</p>
                </div>
                <div class="header-illustration">
                    <ion-icon name="library-outline"></ion-icon>
                </div>
            </div>
        </div>

    <!-- Pesquisa Estilo Gmail -->
    <div class="pesquisa-gmail">
        <div class="search-container">
            <ion-searchbar 
                [(ngModel)]="filtroTexto" 
                (ionInput)="aplicarFiltros()"
                placeholder="Pesquisar turmas" 
                debounce="300"
                show-clear-button="focus"
                class="gmail-search">
            </ion-searchbar>
            
            <ion-button 
                fill="clear" 
                size="small" 
                class="filtros-toggle"
                (click)="toggleFiltrosAvancados()"
                [class.ativo]="mostrarFiltrosAvancados">
                <ion-icon name="options-outline"></ion-icon>
            </ion-button>
        </div>
        
        <!-- Filtros integrados -->
        <div class="filtros-inline" *ngIf="mostrarFiltrosAvancados">
            <div class="filtro-chips">
                <ion-chip 
                    [color]="filtroStatus === 'ativo' ? 'primary' : 'medium'"
                    (click)="toggleFiltroStatus('ativo')"
                    [outline]="filtroStatus !== 'ativo'">
                    <ion-label>Ativas</ion-label>
                </ion-chip>
                
                <ion-chip 
                    [color]="filtroStatus === 'inativo' ? 'danger' : 'medium'"
                    (click)="toggleFiltroStatus('inativo')"
                    [outline]="filtroStatus !== 'inativo'">
                    <ion-label>Inativas</ion-label>
                </ion-chip>
                
                <ion-chip 
                    [color]="filtroStatus === 'com-vagas' ? 'success' : 'medium'"
                    (click)="toggleFiltroStatus('com-vagas')"
                    [outline]="filtroStatus !== 'com-vagas'">
                    <ion-label>Com Vagas</ion-label>
                </ion-chip>
                
                <ion-chip 
                    [color]="filtroStatus === 'lotada' ? 'warning' : 'medium'"
                    (click)="toggleFiltroStatus('lotada')"
                    [outline]="filtroStatus !== 'lotada'">
                    <ion-label>Lotadas</ion-label>
                </ion-chip>
                
                <ion-button 
                    fill="clear" 
                    size="small" 
                    (click)="limparFiltros()"
                    *ngIf="filtroStatus || filtroTexto">
                    <ion-icon name="close" slot="start"></ion-icon>
                    Limpar
                </ion-button>
            </div>
        </div>
    </div>

    <!-- Lista de Turmas em Tabela -->
    <div class="turmas-lista">
        <div class="lista-header">
            <h2>
                Turmas Cadastradas
                <ion-badge color="primary">{{ turmasFiltradas.length }}</ion-badge>
            </h2>

            <ion-button *ngIf="podeGerenciarTurmas" (click)="navegarParaCadastro()" color="primary">
                <ion-icon name="add" slot="start"></ion-icon>
                Nova Turma
            </ion-button>
        </div>

        <!-- Loading -->
        <div *ngIf="loading" class="loading-container">
            <ion-spinner name="crescent"></ion-spinner>
            <p>Carregando turmas...</p>
        </div>

        <!-- Lista vazia -->
        <div *ngIf="!loading && turmasFiltradas.length === 0" class="lista-vazia">
            <ion-icon name="school-outline" color="medium"></ion-icon>
            <h3>Nenhuma turma encontrada</h3>
            <p>
                <span *ngIf="filtroTexto || filtroStatus">
                    Tente ajustar os filtros ou
                </span>
                <span *ngIf="podeGerenciarTurmas">
                    <ion-button fill="clear" (click)="navegarParaCadastro()">
                        criar uma nova turma
                    </ion-button>
                </span>
            </p>
        </div>

        <!-- Tabela de Turmas -->
        <div *ngIf="!loading && turmasFiltradas.length > 0" class="tabela-container">
            <table class="turmas-table">
                <thead>
                    <tr>
                        <th>Nome da Turma</th>
                        <th>Horário</th>
                        <th>Capacidade</th>
                        <th>Status</th>
                        <th>Ações</th>
                    </tr>
                </thead>
                <tbody>
                    <tr *ngFor="let turma of turmasFiltradas" class="turma-row">
                        <td class="nome-turma">
                            <div class="turma-info">
                                <h3>{{ turma.nomeTurma }}</h3>
                            </div>
                        </td>
                        
                        <td class="horario">
                            <div class="horario-info">
                                <span class="label">Início:</span> {{ formatarHorario(turma.horarioInicio) }}
                                <br>
                                <span class="label">Fim:</span> {{ formatarHorario(turma.horarioFim) }}
                            </div>
                        </td>
                        
                        <td class="capacidade">
                            <div class="capacidade-info">
                                <span class="atual">{{ turma.capacidadeAtual }}</span>
                                <span class="separador">/</span>
                                <span class="maxima">{{ turma.capacidadeMaxima }}</span>
                                <div class="progress-bar">
                                    <div class="progress-fill" 
                                         [style.width.%]="(turma.capacidadeAtual / turma.capacidadeMaxima) * 100"
                                         [class.full]="turma.capacidadeAtual === turma.capacidadeMaxima">
                                    </div>
                                </div>
                            </div>
                        </td>
                        
                        <td class="status">
                            <ion-chip [color]="turma.ativo ? 'success' : 'danger'" outline>
                                <ion-icon [name]="turma.ativo ? 'checkmark-circle' : 'close-circle'"></ion-icon>
                                <ion-label>{{ turma.ativo ? 'Ativa' : 'Inativa' }}</ion-label>
                            </ion-chip>
                        </td>
                        
                        <td class="acoes">
                            <div class="acoes-container">
                                <ion-button fill="clear" size="small" color="primary" (click)="verAlunosMatriculados(turma.id!)">
                                    <ion-icon name="people" slot="icon-only"></ion-icon>
                                </ion-button>

                                <ion-button *ngIf="podeGerenciarTurmas" fill="clear" size="small" (click)="editarTurma(turma.id!)">
                                    <ion-icon name="create" slot="icon-only"></ion-icon>
                                </ion-button>

                                <ion-button *ngIf="podeGerenciarTurmas" fill="clear" size="small" color="danger" 
                                            (click)="confirmarExclusao(turma)" [disabled]="turma.capacidadeAtual > 0">
                                    <ion-icon name="trash" slot="icon-only"></ion-icon>
                                </ion-button>
                            </div>
                        </td>
                    </tr>
                </tbody>
            </table>
        </div>
    </div>
    </div>
</ion-content>