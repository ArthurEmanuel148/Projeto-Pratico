<!-- Declaração de Interesse - Novo Fluxo Completo -->
<ion-header [translucent]="true" class="custom-header">



  <!-- Barra de Progresso com Logo - VERSÃO SIMPLIFICADA -->
  <div class="progress-container">
    <div class="progress-header">
      <div class="logo-progress">
        <img src="assets/images/logo-instituto.png" alt="CIPALAM" class="progress-logo">
        <span class="declaration-text">Declaração de Interesse</span>
      </div>
    </div>
    <div class="progress-bar-custom">
      <div class="progress-fill-custom" [style.width.%]="progresso"></div>
    </div>

    <div class="progress-text">
      <span class="progress-percentage">{{ progresso.toFixed(0) }}% Concluído</span>
    </div>
  </div>
</ion-header>

<ion-content [fullscreen]="true" class="custom-content">
  <div class="container">

    <!-- ===== ETAPA 1: DADOS DO RESPONSÁVEL ===== -->
    <div *ngIf="etapaAtual === ETAPAS.DADOS_RESPONSAVEL" class="etapa-container">
      <div class="etapa-header">
        <div class="header-icon">
          <ion-icon name="person-circle-outline" color="primary"></ion-icon>
        </div>
        <div class="header-content">
          <h2>Dados do Responsável</h2>
          <p>Informe os dados da pessoa responsável pela matrícula</p>
        </div>
      </div>

      <form [formGroup]="dadosResponsavelForm" class="form-container">
        <ion-item class="form-item" [class.campo-erro]="isFieldInvalid('nome')">
          <ion-input formControlName="nome" placeholder="Nome completo" [clearInput]="true" fill="outline"
            label="Nome completo" labelPlacement="floating">
          </ion-input>
        </ion-item>
        <div class="mensagem-erro" *ngIf="isFieldInvalid('nome')">
          <ion-icon name="alert-circle" color="danger"></ion-icon>
          <span>{{ getErrorMessage('nome') }}</span>
        </div>

        <ion-item class="form-item" [class.campo-erro]="isFieldInvalid('cpf')">
          <ion-input formControlName="cpf" placeholder="000.000.000-00" maxlength="14" [clearInput]="true"
            fill="outline" label="CPF" labelPlacement="floating" (ionInput)="formatarCpf($event, 'responsavel')">
          </ion-input>
        </ion-item>
        <div class="mensagem-erro" *ngIf="isFieldInvalid('cpf')">
          <ion-icon name="alert-circle" color="danger"></ion-icon>
          <span>{{ getErrorMessage('cpf') }}</span>
        </div>

        <ion-item class="form-item" [class.campo-erro]="isFieldInvalid('dataNascimento')">
          <ion-input formControlName="dataNascimento" type="date" fill="outline" label="Data de nascimento"
            labelPlacement="floating">
          </ion-input>
        </ion-item>
        <div class="mensagem-erro" *ngIf="isFieldInvalid('dataNascimento')">
          <ion-icon name="alert-circle" color="danger"></ion-icon>
          <span>{{ getErrorMessage('dataNascimento') }}</span>
        </div>

        <ion-item class="form-item" [class.campo-erro]="isFieldInvalid('email')">
          <ion-input formControlName="email" type="email" placeholder="email@exemplo.com" [clearInput]="true"
            fill="outline" label="E-mail" labelPlacement="floating">
          </ion-input>
        </ion-item>
        <div class="mensagem-erro" *ngIf="isFieldInvalid('email')">
          <ion-icon name="alert-circle" color="danger"></ion-icon>
          <span>{{ getErrorMessage('email') }}</span>
        </div>

        <ion-item class="form-item" [class.campo-erro]="isFieldInvalid('telefone')">
          <ion-input formControlName="telefone" placeholder="(11) 99999-9999" maxlength="15" [clearInput]="true"
            fill="outline" label="Telefone" labelPlacement="floating" (ionInput)="formatarTelefone($event)">
          </ion-input>
        </ion-item>
        <div class="mensagem-erro" *ngIf="isFieldInvalid('telefone')">
          <ion-icon name="alert-circle" color="danger"></ion-icon>
          <span>{{ getErrorMessage('telefone') }}</span>
        </div>
      </form>
    </div>

    <!-- ===== ETAPA 2: VERIFICAÇÃO DO RESPONSÁVEL ===== -->
    <div *ngIf="etapaAtual === ETAPAS.VERIFICACAO_RESPONSAVEL" class="etapa-container">
      <div class="etapa-header">
        <div class="header-icon">
          <ion-icon name="key-outline" style="color: white; background: var(--ion-color-primary); padding: 12px; border-radius: 50%; font-size: 1.5rem;"></ion-icon>
        </div>
        <div class="header-content">
          <h2>Responsável Já Cadastrado</h2>
          <p>Encontramos um cadastro com este CPF. Por favor, digite sua senha para continuar.</p>
        </div>
      </div>

      <form [formGroup]="verificacaoResponsavelForm" class="form-container">
        <ion-item class="form-item" [class.campo-erro]="isFieldInvalid('senha', verificacaoResponsavelForm)">
          <ion-input formControlName="senha" type="password" placeholder="Digite sua senha" [clearInput]="true"
            fill="outline" label="Senha" labelPlacement="floating">
          </ion-input>
        </ion-item>
        <div class="mensagem-erro" *ngIf="isFieldInvalid('senha', verificacaoResponsavelForm)">
          <ion-icon name="alert-circle" color="danger"></ion-icon>
          <span>{{ getErrorMessage('senha', verificacaoResponsavelForm) }}</span>
        </div>

        <div class="info-card">
          <ion-icon name="information-circle-outline" color="primary"></ion-icon>
          <p>Como este responsável já possui cadastro no instituto, seus dados familiares serão recuperados
            automaticamente caso seja necessário.</p>
        </div>

        <div class="info-card" style="background-color: #f0f8ff; border-left: 4px solid #007bff;">
          <ion-icon name="help-circle-outline" color="primary"></ion-icon>
          <p><strong>Para teste:</strong> Use a senha "123456", "admin" ou os últimos 4 dígitos do CPF.</p>
        </div>
      </form>
    </div>

    <!-- ===== ETAPA 3: DADOS DO ALUNO ===== -->
    <div *ngIf="etapaAtual === ETAPAS.DADOS_ALUNO" class="etapa-container">
      <div class="etapa-header">
        <div class="header-icon">
          <ion-icon name="school-outline" style="color: white; background: var(--ion-color-primary); padding: 12px; border-radius: 50%; font-size: 1.5rem;"></ion-icon>
        </div>
        <div class="header-content">
          <h2>Dados do Aluno</h2>
          <p>Informe os dados do aluno que deseja matricular</p>
        </div>
      </div>

      <form [formGroup]="dadosAlunoForm" class="form-container">
        <ion-item class="form-item" [class.campo-erro]="isFieldInvalid('nome', dadosAlunoForm)">
          <ion-input formControlName="nome" placeholder="Nome completo do aluno" [clearInput]="true" fill="outline"
            label="Nome completo" labelPlacement="floating">
          </ion-input>
        </ion-item>
        <div class="mensagem-erro" *ngIf="isFieldInvalid('nome', dadosAlunoForm)">
          <ion-icon name="alert-circle" color="danger"></ion-icon>
          <span>{{ getErrorMessage('nome', dadosAlunoForm) }}</span>
        </div>

        <ion-item class="form-item" [class.campo-erro]="isFieldInvalid('cpf', dadosAlunoForm)">
          <ion-input formControlName="cpf" placeholder="000.000.000-00" maxlength="14" [clearInput]="true"
            fill="outline" label="CPF do aluno" labelPlacement="floating" (ionInput)="formatarCpf($event, 'aluno')">
          </ion-input>
        </ion-item>
        <div class="mensagem-erro" *ngIf="isFieldInvalid('cpf', dadosAlunoForm)">
          <ion-icon name="alert-circle" color="danger"></ion-icon>
          <span>{{ getErrorMessage('cpf', dadosAlunoForm) }}</span>
        </div>

        <ion-item class="form-item" [class.campo-erro]="isFieldInvalid('dataNascimento', dadosAlunoForm)">
          <ion-input formControlName="dataNascimento" type="date" fill="outline" label="Data de nascimento"
            labelPlacement="floating">
          </ion-input>
        </ion-item>
        <div class="mensagem-erro" *ngIf="isFieldInvalid('dataNascimento', dadosAlunoForm)">
          <ion-icon name="alert-circle" color="danger"></ion-icon>
          <span>{{ getErrorMessage('dataNascimento', dadosAlunoForm) }}</span>
        </div>

        <!-- Campo de Escola Simples -->
        <ion-item class="form-item" [class.campo-erro]="isFieldInvalid('escola', dadosAlunoForm)">
          <ion-input formControlName="escola" placeholder="Nome da escola onde estuda" [clearInput]="true"
            fill="outline" label="Escola onde estuda" labelPlacement="floating">
          </ion-input>
        </ion-item>
        <div class="mensagem-erro" *ngIf="isFieldInvalid('escola', dadosAlunoForm)">
          <ion-icon name="alert-circle" color="danger"></ion-icon>
          <span>{{ getErrorMessage('escola', dadosAlunoForm) }}</span>
        </div>

        <!-- Tipo de Cota -->
        <div class="cota-group">
          <h3>Tipo de Vaga</h3>

          <div class="radio-item">
            <input type="radio" name="tipoCota" value="livre"
              (change)="declaracaoForm.get('tipoCota')?.setValue('livre')"
              [checked]="declaracaoForm.get('tipoCota')?.value === 'livre'">
            <label>
              <h2>Vaga Livre</h2>
              <p>Processo seletivo regular</p>
            </label>
          </div>

          <div class="radio-item">
            <input type="radio" name="tipoCota" value="economica"
              (change)="declaracaoForm.get('tipoCota')?.setValue('economica')"
              [checked]="declaracaoForm.get('tipoCota')?.value === 'economica'">
            <label>
              <h2>Cota Econômica</h2>
              <p>Para famílias de baixa renda</p>
            </label>
          </div>

          <div class="radio-item">
            <input type="radio" name="tipoCota" value="funcionario"
              (change)="declaracaoForm.get('tipoCota')?.setValue('funcionario')"
              [checked]="declaracaoForm.get('tipoCota')?.value === 'funcionario'">
            <label>
              <h2>Cota Funcionário</h2>
              <p>Para filhos de funcionários do instituto</p>
            </label>
          </div>
        </div>

        <!-- Horários Disponíveis -->
        <div class="horarios-container">
          <h3>Horários Disponíveis</h3>
          <div class="horarios-list">
            <div class="checkbox-item">
              <input type="checkbox" value="seg-qua-manha-8h-11h"
                (change)="toggleHorario('seg-qua-manha-8h-11h', $event)">
              <label>
                <h2>Segunda e Quarta - Manhã (8h às 11h)</h2>
                <p>Segunda-feira e Quarta-feira</p>
              </label>
            </div>

            <div class="checkbox-item">
              <input type="checkbox" value="seg-qua-tarde-13h-17h"
                (change)="toggleHorario('seg-qua-tarde-13h-17h', $event)">
              <label>
                <h2>Segunda e Quarta - Tarde (13h às 17h)</h2>
                <p>Segunda-feira e Quarta-feira</p>
              </label>
            </div>

            <div class="checkbox-item">
              <input type="checkbox" value="ter-qui-manha-8h-11h"
                (change)="toggleHorario('ter-qui-manha-8h-11h', $event)">
              <label>
                <h2>Terça e Quinta - Manhã (8h às 11h)</h2>
                <p>Terça-feira e Quinta-feira</p>
              </label>
            </div>

            <div class="checkbox-item">
              <input type="checkbox" value="ter-qui-tarde-13h-17h"
                (change)="toggleHorario('ter-qui-tarde-13h-17h', $event)">
              <label>
                <h2>Terça e Quinta - Tarde (13h às 17h)</h2>
                <p>Terça-feira e Quinta-feira</p>
              </label>
            </div>
          </div>
        </div>
      </form>
    </div>

    <!-- ===== ETAPA 4: DADOS FAMILIARES (só para cota econômica) ===== -->
    <div *ngIf="etapaAtual === ETAPAS.DADOS_FAMILIARES" class="etapa-container">
      <div class="etapa-header">
        <div class="header-icon">
          <ion-icon name="people-outline" color="primary"></ion-icon>
        </div>
        <div class="header-content">
          <h2>Dados Familiares</h2>
          <p>Informe a renda de todos os integrantes da família</p>
        </div>
      </div>

      <div class="info-card" *ngIf="responsavelExiste">
        <ion-icon name="information-circle-outline" color="primary"></ion-icon>
        <p>Como este responsável já possui cadastro, os dados familiares cadastrados anteriormente estão
          pré-preenchidos. Você pode fazer alterações se necessário.</p>
      </div>

      <form [formGroup]="dadosFamiliaresForm" class="form-container">
        <!-- Tabela de Integrantes da Família -->
        <div class="familia-section">
          <div class="section-header">
            <h3>Composição Familiar</h3>
            <p>Liste todos os integrantes da família que possuem renda</p>
          </div>

          <!-- Responsável (dados do banco se já cadastrado, senão do formulário) -->
          <div class="membro-familia responsavel-item">
            <div class="membro-header">
              <ion-icon name="person-circle" color="primary"></ion-icon>
              <span class="membro-tipo">Responsável</span>
              <span *ngIf="responsavelExiste" class="status-badge">Já Cadastrado</span>
            </div>
            <div class="membro-dados">
              <div class="dado-item">
                <label>Nome:</label>
                <span>{{ getResponsavelNome() || 'Não informado' }}</span>
              </div>
              <div class="dado-item">
                <label>CPF:</label>
                <span>{{ getResponsavelCpf() || 'Não informado' }}</span>
              </div>
              <div class="dado-item" *ngIf="responsavelExiste && dadosResponsavel?.email">
                <label>Email:</label>
                <span>{{ dadosResponsavel.email }}</span>
              </div>
              <div class="dado-item" *ngIf="responsavelExiste && dadosResponsavel?.telefone">
                <label>Telefone:</label>
                <span>{{ dadosResponsavel.telefone }}</span>
              </div>
              <div class="inputs-renda">
                <ion-item class="form-item-small">
                  <ion-input placeholder="Ex: Professor, Vendedor, Autônomo" fill="outline" label="Ocupação"
                    labelPlacement="floating" [(ngModel)]="responsavelOcupacao" [ngModelOptions]="{standalone: true}">
                  </ion-input>
                </ion-item>
                <ion-item class="form-item-small">
                  <ion-input type="number" placeholder="0,00" fill="outline" label="Renda Mensal (R$)"
                    labelPlacement="floating" [(ngModel)]="responsavelRenda" [ngModelOptions]="{standalone: true}">
                  </ion-input>
                </ion-item>
              </div>

              <!-- Informação sobre dados pré-cadastrados -->
              <div class="info-responsavel" *ngIf="responsavelExiste">
                <ion-icon name="information-circle-outline" color="primary"></ion-icon>
                <p>Os dados pessoais foram recuperados do cadastro anterior. Informe apenas a ocupação e renda atual.
                </p>
              </div>
            </div>
          </div>

          <!-- Aluno (pré-preenchido) -->
          <div class="membro-familia aluno-item">
            <div class="membro-header">
              <ion-icon name="school" color="primary"></ion-icon>
              <span class="membro-tipo">Aluno</span>
            </div>
            <div class="membro-dados">
              <div class="dado-item">
                <label>Nome:</label>
                <span>{{ dadosAlunoForm.get('nome')?.value || 'Não informado' }}</span>
              </div>
              <div class="dado-item">
                <label>CPF:</label>
                <span>{{ dadosAlunoForm.get('cpf')?.value || 'Não informado' }}</span>
              </div>
              <div class="inputs-renda">
                <ion-item class="form-item-small">
                  <ion-input placeholder="Ex: Estudante, Estagiário, Não trabalha" fill="outline" label="Ocupação"
                    labelPlacement="floating" [(ngModel)]="alunoOcupacao" [ngModelOptions]="{standalone: true}">
                  </ion-input>
                </ion-item>
                <ion-item class="form-item-small">
                  <ion-input type="number" placeholder="0,00" fill="outline" label="Renda Mensal (R$)"
                    labelPlacement="floating" [(ngModel)]="alunoRenda" [ngModelOptions]="{standalone: true}">
                  </ion-input>
                </ion-item>
              </div>
            </div>
          </div>

          <!-- Outros Integrantes (dinâmicos) -->
          <div class="outros-integrantes">
            <div class="section-header">
              <h4>Outros Integrantes da Família</h4>
            </div>

            <div *ngFor="let integrante of integrantesFamilia; let i = index" class="membro-familia integrante-item">
              <div class="membro-header">
                <ion-icon name="person" color="primary"></ion-icon>
                <span class="membro-tipo">Integrante {{ i + 1 }}</span>
                <ion-button fill="clear" color="danger" (click)="removerIntegrante(i)" class="remove-btn">
                  <ion-icon name="trash-outline"></ion-icon>
                </ion-button>
              </div>
              <div class="membro-dados">
                <div class="inputs-info">
                  <ion-item class="form-item-small">
                    <ion-input placeholder="Nome completo" fill="outline" label="Nome" labelPlacement="floating"
                      [(ngModel)]="integrante.nome" [ngModelOptions]="{standalone: true}">
                    </ion-input>
                  </ion-item>
                  <ion-item class="form-item-small">
                    <ion-input placeholder="000.000.000-00" maxlength="14" fill="outline" label="CPF"
                      labelPlacement="floating" [(ngModel)]="integrante.cpf" [ngModelOptions]="{standalone: true}"
                      (ionInput)="formatarCpfIntegrante($event, integrante)">
                    </ion-input>
                  </ion-item>
                </div>
                <div class="inputs-renda">
                  <ion-item class="form-item-small">
                    <ion-input placeholder="Ex: Pai, Mãe, Irmão, Avô" fill="outline" label="Parentesco"
                      labelPlacement="floating" [(ngModel)]="integrante.parentesco"
                      [ngModelOptions]="{standalone: true}">
                    </ion-input>
                  </ion-item>
                  <ion-item class="form-item-small">
                    <ion-input placeholder="Ex: Enfermeiro, Motorista, Aposentado" fill="outline" label="Ocupação"
                      labelPlacement="floating" [(ngModel)]="integrante.ocupacao" [ngModelOptions]="{standalone: true}">
                    </ion-input>
                  </ion-item>
                  <ion-item class="form-item-small">
                    <ion-input type="number" placeholder="0,00" fill="outline" label="Renda Mensal (R$)"
                      labelPlacement="floating" [(ngModel)]="integrante.renda" [ngModelOptions]="{standalone: true}">
                    </ion-input>
                  </ion-item>
                </div>
              </div>
            </div>

            <!-- Botão para adicionar integrante -->
            <ion-button fill="outline" color="primary" (click)="adicionarIntegrante()" class="add-integrante-btn">
              <ion-icon name="person-add-outline" slot="start"></ion-icon>
              Adicionar Integrante
            </ion-button>
          </div>

          <!-- Resumo da Renda Total -->
          <div class="renda-total-card">
            <div class="renda-header">
              <ion-icon name="calculator-outline" color="primary"></ion-icon>
              <h4>Resumo da Renda Familiar</h4>
            </div>
            <div class="renda-detalhes">
              <div class="renda-item">
                <span>Total de integrantes:</span>
                <span class="valor">{{ getTotalIntegrantes() }}</span>
              </div>
              <div class="renda-item total">
                <span>Renda Familiar Total:</span>
                <span class="valor">{{ getRendaFamiliarTotalFormatada() }}</span>
              </div>
              <div class="renda-item per-capita">
                <span>Renda Per Capita:</span>
                <span class="valor">{{ getRendaPerCapitaFormatada() }}</span>
              </div>
            </div>
          </div>
        </div>
      </form>
    </div>

    <!-- ===== ETAPA 5: ENDEREÇO DA FAMÍLIA ===== -->
    <div *ngIf="etapaAtual === ETAPAS.ENDERECO_FAMILIA" class="etapa-container">
      <div class="etapa-header">
        <div class="header-icon">
          <ion-icon name="location-outline" style="color: white; background: var(--ion-color-primary); padding: 12px; border-radius: 50%; font-size: 1.5rem;"></ion-icon>
        </div>
        <div class="header-content">
          <h2>Endereço da Família</h2>
          <p>Informe o endereço completo da residência</p>
        </div>
      </div>

      <form [formGroup]="enderecoForm" class="form-container">
        <ion-item class="form-item" [class.campo-erro]="isFieldInvalid('cep', enderecoForm)">
          <ion-input formControlName="cep" placeholder="00000-000" maxlength="9"
            (ionBlur)="buscarEnderecoPorCep(enderecoForm.get('cep')?.value || '')" [clearInput]="true" fill="outline"
            label="CEP" labelPlacement="floating" (ionInput)="formatarCep($event)">
          </ion-input>
        </ion-item>
        <div class="mensagem-erro" *ngIf="isFieldInvalid('cep', enderecoForm)">
          <ion-icon name="alert-circle" color="danger"></ion-icon>
          <span>{{ getErrorMessage('cep', enderecoForm) }}</span>
        </div>

        <ion-item class="form-item" [class.campo-erro]="isFieldInvalid('logradouro', enderecoForm)">
          <ion-input formControlName="logradouro" placeholder="Rua, Avenida, etc." [clearInput]="true" fill="outline"
            label="Logradouro" labelPlacement="floating">
          </ion-input>
        </ion-item>
        <div class="mensagem-erro" *ngIf="isFieldInvalid('logradouro', enderecoForm)">
          <ion-icon name="alert-circle" color="danger"></ion-icon>
          <span>{{ getErrorMessage('logradouro', enderecoForm) }}</span>
        </div>

        <div class="row-container">
          <ion-item class="form-item flex-2" [class.campo-erro]="isFieldInvalid('numero', enderecoForm)">
            <ion-input formControlName="numero" placeholder="123" [clearInput]="true" fill="outline" label="Número"
              labelPlacement="floating">
            </ion-input>
          </ion-item>
          <div class="mensagem-erro" *ngIf="isFieldInvalid('numero', enderecoForm)">
            <ion-icon name="alert-circle" color="danger"></ion-icon>
            <span>{{ getErrorMessage('numero', enderecoForm) }}</span>
          </div>

          <ion-item class="form-item flex-3">
            <ion-input formControlName="complemento" placeholder="Apto, Bloco, etc." [clearInput]="true" fill="outline"
              label="Complemento" labelPlacement="floating">
            </ion-input>
          </ion-item>
        </div>

        <ion-item class="form-item" [class.campo-erro]="isFieldInvalid('bairro', enderecoForm)">
          <ion-input formControlName="bairro" placeholder="Nome do bairro" [clearInput]="true" fill="outline"
            label="Bairro" labelPlacement="floating">
          </ion-input>
        </ion-item>
        <div class="mensagem-erro" *ngIf="isFieldInvalid('bairro', enderecoForm)">
          <ion-icon name="alert-circle" color="danger"></ion-icon>
          <span>{{ getErrorMessage('bairro', enderecoForm) }}</span>
        </div>

        <div class="row-container">
          <ion-item class="form-item flex-4" [class.campo-erro]="isFieldInvalid('cidade', enderecoForm)">
            <ion-input formControlName="cidade" placeholder="Nome da cidade" [clearInput]="true" fill="outline"
              label="Cidade" labelPlacement="floating">
            </ion-input>
          </ion-item>
          <div class="mensagem-erro" *ngIf="isFieldInvalid('cidade', enderecoForm)">
            <ion-icon name="alert-circle" color="danger"></ion-icon>
            <span>{{ getErrorMessage('cidade', enderecoForm) }}</span>
          </div>

          <ion-item class="form-item flex-1" [class.campo-erro]="isFieldInvalid('uf', enderecoForm)">
            <ion-input formControlName="uf" placeholder="SP" maxlength="2" [clearInput]="true" fill="outline" label="UF"
              labelPlacement="floating">
            </ion-input>
          </ion-item>
          <div class="mensagem-erro" *ngIf="isFieldInvalid('uf', enderecoForm)">
            <ion-icon name="alert-circle" color="danger"></ion-icon>
            <span>{{ getErrorMessage('uf', enderecoForm) }}</span>
          </div>
        </div>

        <ion-item class="form-item">
          <ion-textarea formControlName="pontoReferencia"
            placeholder="Ex: Próximo ao mercado X, em frente à escola Y..." rows="3" fill="outline"
            label="Ponto de referência (opcional)" labelPlacement="floating">
          </ion-textarea>
        </ion-item>
      </form>
    </div>

    <!-- ===== ETAPA 6: OBSERVAÇÕES ===== -->
    <div *ngIf="etapaAtual === ETAPAS.OBSERVACOES" class="etapa-container">
      <div class="etapa-header">
        <div class="header-icon">
          <ion-icon name="document-text-outline" style="color: white; background: var(--ion-color-primary); padding: 12px; border-radius: 50%; font-size: 1.5rem;"></ion-icon>
        </div>
        <div class="header-content">
          <h2>Observações</h2>
          <p>Informações relevantes sobre o aluno</p>
        </div>
      </div>

      <form [formGroup]="declaracaoForm" class="form-container">
        <ion-item class="form-item">
          <ion-textarea formControlName="observacoes"
            placeholder="Ex: Criança muito ativa, tem dificuldades de aprendizagem, necessidades especiais, etc..."
            rows="6" fill="outline" label="Observações sobre o aluno (opcional)" labelPlacement="floating">
          </ion-textarea>
        </ion-item>

        <div class="info-card">
          <ion-icon name="information-circle-outline" color="primary"></ion-icon>
          <p>Essas informações ajudam nossa equipe pedagógica a conhecer melhor o aluno e preparar um atendimento mais
            adequado.</p>
        </div>
      </form>
    </div>

    <!-- ===== ETAPA 7: REVISÃO FINAL ===== -->
    <div *ngIf="etapaAtual === ETAPAS.REVISAO" class="etapa-container">
      <div class="etapa-header">
        <div class="header-icon">
          <ion-icon name="checkmark-circle-outline" color="primary"></ion-icon>
        </div>
        <div class="header-content">
          <h2>Revisão Final</h2>
          <p>Confira todos os dados antes de enviar</p>
        </div>
      </div>

      <div class="revisao-container">
        <!-- Dados do Responsável -->
        <div class="revisao-section">
          <h3>Dados do Responsável</h3>
          <div class="revisao-item">
            <span class="label">Nome:</span>
            <span class="value">{{ dadosResponsavelForm.get('nome')?.value }}</span>
          </div>
          <div class="revisao-item">
            <span class="label">CPF:</span>
            <span class="value">{{ dadosResponsavelForm.get('cpf')?.value }}</span>
          </div>
          <div class="revisao-item">
            <span class="label">E-mail:</span>
            <span class="value">{{ dadosResponsavelForm.get('email')?.value }}</span>
          </div>
          <div class="revisao-item">
            <span class="label">Telefone:</span>
            <span class="value">{{ dadosResponsavelForm.get('telefone')?.value }}</span>
          </div>
        </div>

        <!-- Dados do Aluno -->
        <div class="revisao-section">
          <h3>Dados do Aluno</h3>
          <div class="revisao-item">
            <span class="label">Nome:</span>
            <span class="value">{{ dadosAlunoForm.get('nome')?.value }}</span>
          </div>
          <div class="revisao-item">
            <span class="label">CPF:</span>
            <span class="value">{{ dadosAlunoForm.get('cpf')?.value }}</span>
          </div>
          <div class="revisao-item">
            <span class="label">Escola:</span>
            <span class="value">{{ dadosAlunoForm.get('escola')?.value }}</span>
          </div>
          <div class="revisao-item">
            <span class="label">Tipo de Vaga:</span>
            <span class="value">{{ declaracaoForm.get('tipoCota')?.value }}</span>
          </div>
        </div>

        <!-- Endereço -->
        <div class="revisao-section">
          <h3>Endereço</h3>
          <div class="revisao-item">
            <span class="label">Endereço:</span>
            <span class="value">
              {{ enderecoForm.get('logradouro')?.value }},
              {{ enderecoForm.get('numero')?.value }}
              <span *ngIf="enderecoForm.get('complemento')?.value"> - {{ enderecoForm.get('complemento')?.value
                }}</span>
            </span>
          </div>
          <div class="revisao-item">
            <span class="label">Bairro:</span>
            <span class="value">{{ enderecoForm.get('bairro')?.value }}</span>
          </div>
          <div class="revisao-item">
            <span class="label">Cidade/UF:</span>
            <span class="value">{{ enderecoForm.get('cidade')?.value }}/{{ enderecoForm.get('uf')?.value }}</span>
          </div>
          <div class="revisao-item">
            <span class="label">CEP:</span>
            <span class="value">{{ enderecoForm.get('cep')?.value }}</span>
          </div>
        </div>
      </div>
    </div>

    <!-- ===== ETAPA 8: CONCLUÍDO ===== -->
    <div *ngIf="etapaAtual === ETAPAS.CONCLUIDO" class="etapa-container concluido">
      <div class="success-container">
        <ion-icon name="checkmark-circle" color="success" class="success-icon"></ion-icon>
        <h2>Declaração Enviada com Sucesso!</h2>
        <p>Sua declaração de interesse foi recebida e está sendo analisada.</p>

        <div class="info-card">
          <ion-icon name="information-circle-outline" color="primary"></ion-icon>
          <p>Você será contatado por e-mail ou telefone assim que houver atualizações sobre o processo de matrícula.</p>
        </div>

        <ion-button expand="block" color="success" (click)="voltarParaInicio()" class="action-button">
          <ion-icon name="home-outline" slot="start"></ion-icon>
          Voltar ao Início
        </ion-button>
      </div>
    </div>

    <!-- Botões de Navegação -->
    <div class="navigation-buttons" *ngIf="etapaAtual !== ETAPAS.CONCLUIDO">
      <ion-button expand="block" color="success" (click)="proximaEtapa()" [disabled]="isSubmitting"
        class="action-button">
        <span *ngIf="etapaAtual === ETAPAS.REVISAO">
          <ion-icon name="send-outline" slot="start"></ion-icon>
          Enviar Declaração
        </span>
        <span *ngIf="etapaAtual !== ETAPAS.REVISAO">
          Prosseguir
          <ion-icon name="chevron-forward-outline" slot="end"></ion-icon>
        </span>
      </ion-button>
    </div>

  </div>
</ion-content>