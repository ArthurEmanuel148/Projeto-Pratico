<ion-header [translucent]="true" class="custom-header">
    <ion-toolbar>
        <ion-buttons slot="start">
            <ion-back-button defaultHref="/" text=""></ion-back-button>
        </ion-buttons>
        <ion-title>Selecionar Turma</ion-title>
    </ion-toolbar>
</ion-header>

<ion-content>
    <!-- Loading -->
    <div *ngIf="isLoading" class="loading-container">
        <ion-spinner></ion-spinner>
        <p>Carregando turmas disponíveis...</p>
    </div>

    <!-- Conteúdo principal -->
    <div *ngIf="!isLoading" class="content-container">

        <!-- Informações da declaração -->
        <ion-card *ngIf="declaracaoSelecionada" class="declaracao-card compact">
            <ion-card-header>
                <ion-card-title>
                    <ion-icon name="document-text" color="primary"></ion-icon>
                    Declaração Selecionada
                </ion-card-title>
            </ion-card-header>
            <ion-card-content>
                <div class="declaracao-info-grid">
                    <div class="info-row">
                        <div class="info-item compact">
                            <span class="label">Protocolo:</span>
                            <span class="value">{{ declaracaoSelecionada.protocolo }}</span>
                        </div>
                        <div class="info-item compact">
                            <span class="label">Tipo:</span>
                            <span class="value">{{ declaracaoSelecionada.tipoCotaDescricao }}</span>
                        </div>
                        <div class="info-item compact">
                            <span class="label">Aguarda:</span>
                            <span class="value">{{ declaracaoSelecionada.diasAguardando }} dias</span>
                        </div>
                    </div>
                    <div class="info-row">
                        <div class="info-item compact full-width">
                            <span class="label">Aluno:</span>
                            <span class="value">{{ declaracaoSelecionada.nomeAluno }}</span>
                        </div>
                        <div class="info-item compact full-width">
                            <span class="label">Responsável:</span>
                            <span class="value">{{ declaracaoSelecionada.nomeResponsavel }}</span>
                        </div>
                    </div>
                </div>
            </ion-card-content>
        </ion-card>

        <!-- Lista de turmas disponíveis -->
        <ion-card class="turmas-card">
            <ion-card-header>
                <ion-card-title>
                    <ion-icon name="school" color="secondary"></ion-icon>
                    Turmas Disponíveis
                </ion-card-title>
                <ion-card-subtitle>
                    {{ turmasDisponiveis.length }} turma(s) com vagas disponíveis
                </ion-card-subtitle>
            </ion-card-header>
            <ion-card-content>

                <!-- Nenhuma turma disponível -->
                <div *ngIf="turmasDisponiveis.length === 0" class="no-turmas">
                    <ion-icon name="alert-circle" color="warning" size="large"></ion-icon>
                    <h3>Nenhuma turma disponível</h3>
                    <p>No momento não há turmas com vagas disponíveis. Tente novamente mais tarde.</p>
                </div>

                <!-- Lista de turmas -->
                <div *ngIf="turmasDisponiveis.length > 0" class="turmas-container">
                    <ion-radio-group [(ngModel)]="turmaSelecionada" (ionChange)="selecionarTurma($event.detail.value)">

                        <div *ngFor="let turma of turmasDisponiveis; let i = index" class="turma-card"
                            [class.selected]="turmaSelecionada?.id === turma.id">

                            <ion-card class="individual-turma-card"
                                [class.selected-card]="turmaSelecionada?.id === turma.id">
                                <div class="turma-content" (click)="selecionarTurma(turma)">
                                    <div class="turma-header">
                                        <div class="turma-title-section">
                                            <ion-radio [value]="turma" class="custom-radio"></ion-radio>
                                            <div class="title-info">
                                                <h2>{{ turma.nomeTurma || turma.nome }}</h2>
                                                <div class="turma-subtitle">
                                                    <ion-icon name="time-outline"></ion-icon>
                                                    <span>{{ turma.horarioInicio }} às {{ turma.horarioFim }}</span>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="vagas-badge" [ngClass]="getVagasClass(turma.vagasDisponiveis)">
                                            <ion-icon name="people"></ion-icon>
                                            {{ turma.vagasDisponiveis }} VAGAS
                                        </div>
                                    </div>

                                    <div class="turma-stats">
                                        <div class="stat-item">
                                            <ion-icon name="person-circle-outline" color="medium"></ion-icon>
                                            <div class="stat-info">
                                                <span class="stat-label">Matriculados</span>
                                                <span class="stat-value">{{ turma.capacidadeMaxima -
                                                    turma.vagasDisponiveis }}/{{ turma.capacidadeMaxima }}</span>
                                            </div>
                                        </div>

                                        <div class="stat-item">
                                            <ion-icon name="checkmark-circle-outline" color="success"></ion-icon>
                                            <div class="stat-info">
                                                <span class="stat-label">Disponíveis</span>
                                                <span class="stat-value">{{ turma.vagasDisponiveis }} vagas</span>
                                            </div>
                                        </div>
                                    </div>

                                </div>
                            </ion-card>

                        </div>

                    </ion-radio-group>
                </div>

            </ion-card-content>
        </ion-card>

        <!-- Botões de ação -->
        <div class="form-actions">
            <ion-button fill="clear" color="medium" size="large" (click)="voltar()">
                <ion-icon name="arrow-back-outline" slot="start"></ion-icon>
                Voltar para Lista
            </ion-button>

            <ion-button color="primary" size="large" [disabled]="!turmaSelecionada" (click)="confirmarSelecao()">
                <ion-icon name="checkmark-outline" slot="start"></ion-icon>
                Confirmar Seleção
            </ion-button>
        </div>
    </div>
</ion-content>